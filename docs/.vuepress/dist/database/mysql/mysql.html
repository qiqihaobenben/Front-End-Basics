<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mysql 必知必会 | Front-End-Basics</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="陈方旭的个人文档">
    
    <link rel="preload" href="/assets/css/0.styles.8f3dca9f.css" as="style"><link rel="preload" href="/assets/js/app.f0c3bf6e.js" as="script"><link rel="preload" href="/assets/js/2.267df354.js" as="script"><link rel="preload" href="/assets/js/1.66cc43cf.js" as="script"><link rel="preload" href="/assets/js/133.cc4ee14d.js" as="script"><link rel="prefetch" href="/assets/js/10.8ed5e327.js"><link rel="prefetch" href="/assets/js/100.ae5b3443.js"><link rel="prefetch" href="/assets/js/101.cc73b0f5.js"><link rel="prefetch" href="/assets/js/102.3f3114fb.js"><link rel="prefetch" href="/assets/js/103.8ff5fdac.js"><link rel="prefetch" href="/assets/js/104.b5debdc3.js"><link rel="prefetch" href="/assets/js/105.8da11418.js"><link rel="prefetch" href="/assets/js/106.4dbe9edc.js"><link rel="prefetch" href="/assets/js/107.181bae05.js"><link rel="prefetch" href="/assets/js/108.89a63e22.js"><link rel="prefetch" href="/assets/js/109.ce54155a.js"><link rel="prefetch" href="/assets/js/11.066e1c25.js"><link rel="prefetch" href="/assets/js/110.f2e608ea.js"><link rel="prefetch" href="/assets/js/111.42921b66.js"><link rel="prefetch" href="/assets/js/112.8da31ceb.js"><link rel="prefetch" href="/assets/js/113.5ac3f0d4.js"><link rel="prefetch" href="/assets/js/114.e056e614.js"><link rel="prefetch" href="/assets/js/115.cebf7fde.js"><link rel="prefetch" href="/assets/js/116.2b434a84.js"><link rel="prefetch" href="/assets/js/117.100c132f.js"><link rel="prefetch" href="/assets/js/118.a4afed9a.js"><link rel="prefetch" href="/assets/js/119.f0f1a25d.js"><link rel="prefetch" href="/assets/js/12.9fe465cb.js"><link rel="prefetch" href="/assets/js/120.376850c5.js"><link rel="prefetch" href="/assets/js/121.5dc1a6a2.js"><link rel="prefetch" href="/assets/js/122.363693fb.js"><link rel="prefetch" href="/assets/js/123.7258fb95.js"><link rel="prefetch" href="/assets/js/124.a4bd3167.js"><link rel="prefetch" href="/assets/js/125.8aa8db7c.js"><link rel="prefetch" href="/assets/js/126.2caa71e3.js"><link rel="prefetch" href="/assets/js/127.220486dd.js"><link rel="prefetch" href="/assets/js/128.b01fb70e.js"><link rel="prefetch" href="/assets/js/129.bd8c1b32.js"><link rel="prefetch" href="/assets/js/13.ceec992d.js"><link rel="prefetch" href="/assets/js/130.9b3fd30c.js"><link rel="prefetch" href="/assets/js/131.c1e91c2d.js"><link rel="prefetch" href="/assets/js/132.6d39b36b.js"><link rel="prefetch" href="/assets/js/134.3b031de3.js"><link rel="prefetch" href="/assets/js/135.329aa943.js"><link rel="prefetch" href="/assets/js/136.e97d2b91.js"><link rel="prefetch" href="/assets/js/137.70ad5edc.js"><link rel="prefetch" href="/assets/js/138.b2388813.js"><link rel="prefetch" href="/assets/js/139.260e94e8.js"><link rel="prefetch" href="/assets/js/14.6b9e2f92.js"><link rel="prefetch" href="/assets/js/140.d0752482.js"><link rel="prefetch" href="/assets/js/141.c3809389.js"><link rel="prefetch" href="/assets/js/142.909571e7.js"><link rel="prefetch" href="/assets/js/143.9c55503a.js"><link rel="prefetch" href="/assets/js/144.037eb178.js"><link rel="prefetch" href="/assets/js/145.b15eb629.js"><link rel="prefetch" href="/assets/js/146.92f941e0.js"><link rel="prefetch" href="/assets/js/147.ee679e8f.js"><link rel="prefetch" href="/assets/js/148.259bd94c.js"><link rel="prefetch" href="/assets/js/149.0560570b.js"><link rel="prefetch" href="/assets/js/15.d25af981.js"><link rel="prefetch" href="/assets/js/150.e0970997.js"><link rel="prefetch" href="/assets/js/151.8c91c562.js"><link rel="prefetch" href="/assets/js/152.b2680c3d.js"><link rel="prefetch" href="/assets/js/153.43d5659d.js"><link rel="prefetch" href="/assets/js/154.41332198.js"><link rel="prefetch" href="/assets/js/155.36a0da41.js"><link rel="prefetch" href="/assets/js/156.8d9c6ad6.js"><link rel="prefetch" href="/assets/js/157.016cc281.js"><link rel="prefetch" href="/assets/js/158.c846bda8.js"><link rel="prefetch" href="/assets/js/159.60ef4fd7.js"><link rel="prefetch" href="/assets/js/16.fe68c618.js"><link rel="prefetch" href="/assets/js/160.e000f0e7.js"><link rel="prefetch" href="/assets/js/161.f67efc97.js"><link rel="prefetch" href="/assets/js/162.4eadc328.js"><link rel="prefetch" href="/assets/js/163.39e9bbe6.js"><link rel="prefetch" href="/assets/js/164.8e990d4c.js"><link rel="prefetch" href="/assets/js/165.9cc5569d.js"><link rel="prefetch" href="/assets/js/166.dcfd67ce.js"><link rel="prefetch" href="/assets/js/167.0a12942f.js"><link rel="prefetch" href="/assets/js/168.db0cf4d8.js"><link rel="prefetch" href="/assets/js/169.0177438a.js"><link rel="prefetch" href="/assets/js/17.de0b324b.js"><link rel="prefetch" href="/assets/js/170.799f7bf1.js"><link rel="prefetch" href="/assets/js/171.72b504b4.js"><link rel="prefetch" href="/assets/js/172.3fedbd3b.js"><link rel="prefetch" href="/assets/js/173.9d2d86ef.js"><link rel="prefetch" href="/assets/js/174.1a15c5a7.js"><link rel="prefetch" href="/assets/js/175.62da2bad.js"><link rel="prefetch" href="/assets/js/176.fa85299a.js"><link rel="prefetch" href="/assets/js/177.a4f8a83d.js"><link rel="prefetch" href="/assets/js/178.3da2977b.js"><link rel="prefetch" href="/assets/js/179.5a0698c9.js"><link rel="prefetch" href="/assets/js/18.75c085a9.js"><link rel="prefetch" href="/assets/js/180.b3c22f44.js"><link rel="prefetch" href="/assets/js/181.258acfab.js"><link rel="prefetch" href="/assets/js/182.3b612a1c.js"><link rel="prefetch" href="/assets/js/183.04d35baf.js"><link rel="prefetch" href="/assets/js/184.2f6ebfb6.js"><link rel="prefetch" href="/assets/js/185.3d2ba522.js"><link rel="prefetch" href="/assets/js/186.85211aa8.js"><link rel="prefetch" href="/assets/js/187.3a727290.js"><link rel="prefetch" href="/assets/js/188.39112337.js"><link rel="prefetch" href="/assets/js/189.160e194c.js"><link rel="prefetch" href="/assets/js/19.7d112bce.js"><link rel="prefetch" href="/assets/js/190.c053d7a2.js"><link rel="prefetch" href="/assets/js/191.22cefdac.js"><link rel="prefetch" href="/assets/js/192.964f5e88.js"><link rel="prefetch" href="/assets/js/193.700abf9f.js"><link rel="prefetch" href="/assets/js/194.e267a0f1.js"><link rel="prefetch" href="/assets/js/195.e49141be.js"><link rel="prefetch" href="/assets/js/196.abd378ac.js"><link rel="prefetch" href="/assets/js/197.49b8f519.js"><link rel="prefetch" href="/assets/js/198.f60281e1.js"><link rel="prefetch" href="/assets/js/199.2444da81.js"><link rel="prefetch" href="/assets/js/20.81f5b440.js"><link rel="prefetch" href="/assets/js/200.54f5e6d4.js"><link rel="prefetch" href="/assets/js/201.132bab0f.js"><link rel="prefetch" href="/assets/js/202.cd5ef700.js"><link rel="prefetch" href="/assets/js/203.6524ae1d.js"><link rel="prefetch" href="/assets/js/204.79049883.js"><link rel="prefetch" href="/assets/js/205.b453ac0d.js"><link rel="prefetch" href="/assets/js/206.8e68e3cb.js"><link rel="prefetch" href="/assets/js/207.0dbf0bb5.js"><link rel="prefetch" href="/assets/js/208.a6f0aa62.js"><link rel="prefetch" href="/assets/js/209.5eb00898.js"><link rel="prefetch" href="/assets/js/21.b8f03079.js"><link rel="prefetch" href="/assets/js/210.5394d572.js"><link rel="prefetch" href="/assets/js/211.4d73566d.js"><link rel="prefetch" href="/assets/js/212.01ea7dd7.js"><link rel="prefetch" href="/assets/js/213.80261d17.js"><link rel="prefetch" href="/assets/js/214.42974ae8.js"><link rel="prefetch" href="/assets/js/215.6a9aefd7.js"><link rel="prefetch" href="/assets/js/216.71698897.js"><link rel="prefetch" href="/assets/js/217.cbdb7908.js"><link rel="prefetch" href="/assets/js/218.e1ca46a4.js"><link rel="prefetch" href="/assets/js/219.4bff8927.js"><link rel="prefetch" href="/assets/js/22.ce37cd53.js"><link rel="prefetch" href="/assets/js/220.d29e2c08.js"><link rel="prefetch" href="/assets/js/221.6a2c607c.js"><link rel="prefetch" href="/assets/js/222.7209db02.js"><link rel="prefetch" href="/assets/js/223.18f8b9df.js"><link rel="prefetch" href="/assets/js/224.52b820e0.js"><link rel="prefetch" href="/assets/js/225.46e90caa.js"><link rel="prefetch" href="/assets/js/226.63ed554a.js"><link rel="prefetch" href="/assets/js/227.7fafc4da.js"><link rel="prefetch" href="/assets/js/228.7706dc54.js"><link rel="prefetch" href="/assets/js/229.842a1964.js"><link rel="prefetch" href="/assets/js/23.87e7e45e.js"><link rel="prefetch" href="/assets/js/230.ddc0f55a.js"><link rel="prefetch" href="/assets/js/231.e72fa0a7.js"><link rel="prefetch" href="/assets/js/232.e15e10a1.js"><link rel="prefetch" href="/assets/js/233.9001d006.js"><link rel="prefetch" href="/assets/js/234.c55b49d9.js"><link rel="prefetch" href="/assets/js/235.da1bf5f9.js"><link rel="prefetch" href="/assets/js/236.9efb932c.js"><link rel="prefetch" href="/assets/js/237.67412574.js"><link rel="prefetch" href="/assets/js/238.24ef619f.js"><link rel="prefetch" href="/assets/js/239.1f2a6298.js"><link rel="prefetch" href="/assets/js/24.5aa30e8d.js"><link rel="prefetch" href="/assets/js/240.9c9279b1.js"><link rel="prefetch" href="/assets/js/241.695630cd.js"><link rel="prefetch" href="/assets/js/242.891e7aef.js"><link rel="prefetch" href="/assets/js/243.edd26862.js"><link rel="prefetch" href="/assets/js/244.ed576d71.js"><link rel="prefetch" href="/assets/js/245.d10042cf.js"><link rel="prefetch" href="/assets/js/246.d57006a7.js"><link rel="prefetch" href="/assets/js/247.b2d6742e.js"><link rel="prefetch" href="/assets/js/248.8b56d853.js"><link rel="prefetch" href="/assets/js/249.b8fc1805.js"><link rel="prefetch" href="/assets/js/25.5c7b2cfe.js"><link rel="prefetch" href="/assets/js/250.1aad43ae.js"><link rel="prefetch" href="/assets/js/251.be9db929.js"><link rel="prefetch" href="/assets/js/252.afedca09.js"><link rel="prefetch" href="/assets/js/253.c6e86855.js"><link rel="prefetch" href="/assets/js/254.90b4f52a.js"><link rel="prefetch" href="/assets/js/255.227c9c47.js"><link rel="prefetch" href="/assets/js/256.fe3714d4.js"><link rel="prefetch" href="/assets/js/257.3e5db4f7.js"><link rel="prefetch" href="/assets/js/258.29013d06.js"><link rel="prefetch" href="/assets/js/259.e9af4b51.js"><link rel="prefetch" href="/assets/js/26.5a8e32e6.js"><link rel="prefetch" href="/assets/js/260.9555612d.js"><link rel="prefetch" href="/assets/js/261.e8e200a0.js"><link rel="prefetch" href="/assets/js/262.0f393806.js"><link rel="prefetch" href="/assets/js/263.42b99650.js"><link rel="prefetch" href="/assets/js/264.5e36cccd.js"><link rel="prefetch" href="/assets/js/265.e7759e0e.js"><link rel="prefetch" href="/assets/js/266.2bce58fa.js"><link rel="prefetch" href="/assets/js/267.6e2a5a40.js"><link rel="prefetch" href="/assets/js/27.997b1485.js"><link rel="prefetch" href="/assets/js/28.ef6638c6.js"><link rel="prefetch" href="/assets/js/29.c9d728b9.js"><link rel="prefetch" href="/assets/js/3.dc3407e1.js"><link rel="prefetch" href="/assets/js/30.d873fb03.js"><link rel="prefetch" href="/assets/js/31.2bf741ce.js"><link rel="prefetch" href="/assets/js/32.551ac32b.js"><link rel="prefetch" href="/assets/js/33.b6573b5c.js"><link rel="prefetch" href="/assets/js/34.b46900a8.js"><link rel="prefetch" href="/assets/js/35.f131466c.js"><link rel="prefetch" href="/assets/js/36.89942ede.js"><link rel="prefetch" href="/assets/js/37.0e54922b.js"><link rel="prefetch" href="/assets/js/38.36f714a1.js"><link rel="prefetch" href="/assets/js/39.2256d2d3.js"><link rel="prefetch" href="/assets/js/4.43d53c19.js"><link rel="prefetch" href="/assets/js/40.784c879e.js"><link rel="prefetch" href="/assets/js/41.8bac5a7b.js"><link rel="prefetch" href="/assets/js/42.b6e7fc8b.js"><link rel="prefetch" href="/assets/js/43.ab92dcea.js"><link rel="prefetch" href="/assets/js/44.666a8d67.js"><link rel="prefetch" href="/assets/js/45.23a7d54d.js"><link rel="prefetch" href="/assets/js/46.c90bff29.js"><link rel="prefetch" href="/assets/js/47.b109dec7.js"><link rel="prefetch" href="/assets/js/48.7f766765.js"><link rel="prefetch" href="/assets/js/49.0a8e763d.js"><link rel="prefetch" href="/assets/js/5.b6321aed.js"><link rel="prefetch" href="/assets/js/50.686d1521.js"><link rel="prefetch" href="/assets/js/51.9936e373.js"><link rel="prefetch" href="/assets/js/52.f0b789de.js"><link rel="prefetch" href="/assets/js/53.5438164d.js"><link rel="prefetch" href="/assets/js/54.ec6f1f74.js"><link rel="prefetch" href="/assets/js/55.002caceb.js"><link rel="prefetch" href="/assets/js/56.d7896533.js"><link rel="prefetch" href="/assets/js/57.560f886c.js"><link rel="prefetch" href="/assets/js/58.ede39d55.js"><link rel="prefetch" href="/assets/js/59.f8e25f0e.js"><link rel="prefetch" href="/assets/js/6.8dc86351.js"><link rel="prefetch" href="/assets/js/60.16e85fb0.js"><link rel="prefetch" href="/assets/js/61.c4a68cdb.js"><link rel="prefetch" href="/assets/js/62.b8285ec7.js"><link rel="prefetch" href="/assets/js/63.cea2c4d9.js"><link rel="prefetch" href="/assets/js/64.33d06366.js"><link rel="prefetch" href="/assets/js/65.7dacc788.js"><link rel="prefetch" href="/assets/js/66.1c982721.js"><link rel="prefetch" href="/assets/js/67.5509334e.js"><link rel="prefetch" href="/assets/js/68.f9deb190.js"><link rel="prefetch" href="/assets/js/69.fd052a09.js"><link rel="prefetch" href="/assets/js/7.4de4dc57.js"><link rel="prefetch" href="/assets/js/70.b36ecec1.js"><link rel="prefetch" href="/assets/js/71.09472ede.js"><link rel="prefetch" href="/assets/js/72.7fc03c28.js"><link rel="prefetch" href="/assets/js/73.1df4ed7b.js"><link rel="prefetch" href="/assets/js/74.eef842dd.js"><link rel="prefetch" href="/assets/js/75.a4642706.js"><link rel="prefetch" href="/assets/js/76.2921120f.js"><link rel="prefetch" href="/assets/js/77.8959d3b8.js"><link rel="prefetch" href="/assets/js/78.15af67c9.js"><link rel="prefetch" href="/assets/js/79.ca2b3995.js"><link rel="prefetch" href="/assets/js/80.86253068.js"><link rel="prefetch" href="/assets/js/81.4dfb5100.js"><link rel="prefetch" href="/assets/js/82.40f05690.js"><link rel="prefetch" href="/assets/js/83.ae59f017.js"><link rel="prefetch" href="/assets/js/84.a16c2086.js"><link rel="prefetch" href="/assets/js/85.78764153.js"><link rel="prefetch" href="/assets/js/86.6da75781.js"><link rel="prefetch" href="/assets/js/87.9093c83e.js"><link rel="prefetch" href="/assets/js/88.1b71ff61.js"><link rel="prefetch" href="/assets/js/89.c3298594.js"><link rel="prefetch" href="/assets/js/90.dbab72f7.js"><link rel="prefetch" href="/assets/js/91.201c3950.js"><link rel="prefetch" href="/assets/js/92.23d20e66.js"><link rel="prefetch" href="/assets/js/93.35dc98bf.js"><link rel="prefetch" href="/assets/js/94.da768453.js"><link rel="prefetch" href="/assets/js/95.9767a2ff.js"><link rel="prefetch" href="/assets/js/96.890fcdc4.js"><link rel="prefetch" href="/assets/js/97.4bdcd3d5.js"><link rel="prefetch" href="/assets/js/98.972a16fd.js"><link rel="prefetch" href="/assets/js/99.44f9b5d3.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.a900b7e8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f3dca9f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Front-End-Basics" class="logo"> <span class="site-name can-hide">Front-End-Basics</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/article/" class="nav-link">
  捡贝壳
</a></div> <a href="https://github.com/qiqihaobenben/Front-End-Basics" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/article/" class="nav-link">
  捡贝壳
</a></div> <a href="https://github.com/qiqihaobenben/Front-End-Basics" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MySQL</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database/mysql/mysql.html" aria-current="page" class="active sidebar-link">Mysql 必知必会</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mysql-必知必会"><a href="#mysql-必知必会" class="header-anchor">#</a> Mysql 必知必会</h1> <h2 id="术语"><a href="#术语" class="header-anchor">#</a> 术语</h2> <p>不同的人可能会使用相同的数据库术语表示不同的事物，会造成一些混乱，下面是一张重要的数据库术语清单。</p> <h3 id="数据库-database"><a href="#数据库-database" class="header-anchor">#</a> 数据库（database）</h3> <p><strong>数据库是保存有组织的数据的容器（通常是一个文件或一组文件）。</strong></p> <blockquote><p>易混点：人们经常用“数据库”这个词代表他们使用的数据库软件。数据库软件是 DBMS(数据库管理系统)，例如 MySQL 就是一种 DBMS ，而数据库是通过 DBMS 创建和操纵的容器。我们通常不直接访问数据库，而是通过使用 DBMS 来访问数据库。</p></blockquote> <h3 id="表-table"><a href="#表-table" class="header-anchor">#</a> 表（table）</h3> <p><strong>表是某种特定类型数据的结构化清单。</strong></p> <p>数据库中的每个表都有一个名字，用来标识自己，称之为“表名”。此名字是唯一的，在相同的数据库中不能使用重复的表名，但是在不同的数据库中可以使用。</p> <h3 id="模式-schema"><a href="#模式-schema" class="header-anchor">#</a> 模式（schema）</h3> <p><strong>模式是关于数据库和表的布局及特性的信息。</strong></p> <h3 id="列-column"><a href="#列-column" class="header-anchor">#</a> 列（column）</h3> <p><strong>列是表中的一个字段。所有的表都是由一个或多个列组成的。</strong></p> <h3 id="数据类型-datatype"><a href="#数据类型-datatype" class="header-anchor">#</a> 数据类型（datatype）</h3> <p><strong>数据类型是所容许的数据的类型。每个表列都有相应的数据类型，它限制（或容许）该列中存储的数据类型。</strong></p> <h3 id="行-row"><a href="#行-row" class="header-anchor">#</a> 行（row）</h3> <p><strong>行是表中的一个记录。</strong></p> <p>有人会把行（row）称之为数据库记录（record），这两个数据是可以互相代替的，但是从技术上说，行才是正确的术语。</p> <h3 id="主键-primary-key"><a href="#主键-primary-key" class="header-anchor">#</a> 主键（primary key）</h3> <p><strong>主键是一列（或一组列），其值能够唯一区分表中每个行。</strong></p> <p>表中的任何列只要满足以下条件，都可以作为主键：</p> <ul><li>任意两行都不具有相同的主键值；</li> <li>每个行都必须具有一个主键值（主键列不允许 NULL 值）</li></ul> <p>此外还有几个主键的最佳实践：</p> <ul><li>不更新主键列中的值；</li> <li>不重用主键列的值；</li> <li>不在主键列中使用可能会更改的值。（例如，如果使用一个名字作为主键以标识某个供应商，当该供应商合并和更改其名字时，就得必须更改这个主键。）</li></ul> <h3 id="外键-foreign-key"><a href="#外键-foreign-key" class="header-anchor">#</a> 外键（foreign key）</h3> <p>外键为某个表中的一列，它包含另一个表的主键值，定义了两个表之间的关系。</p> <h3 id="子句-clause"><a href="#子句-clause" class="header-anchor">#</a> 子句（clause）</h3> <p>SQL 语句由子句构成，有些子句是必需的，而有的是可选的。一个子句通常由一个关键字和所提供的数据组成。例如 SELECT 语句的 FROM 子句。</p> <h3 id="操作符-operator"><a href="#操作符-operator" class="header-anchor">#</a> 操作符（operator）</h3> <p>用来联结或改变 WHERE 子句中的子句的关键字。也称为 <strong>逻辑操作符（logical operator）</strong></p> <h3 id="通配符-wildcard"><a href="#通配符-wildcard" class="header-anchor">#</a> 通配符（wildcard）</h3> <p>用来匹配值的一部分的特殊字符。</p> <h3 id="搜索模式-search-pattern"><a href="#搜索模式-search-pattern" class="header-anchor">#</a> 搜索模式（search pattern）</h3> <p>由字面量、通配符或两者组合构成的搜索条件</p> <h3 id="拼接-concatenate"><a href="#拼接-concatenate" class="header-anchor">#</a> 拼接（concatenate）</h3> <p>将值联结到一起构成单个值</p> <h3 id="别名-alias"><a href="#别名-alias" class="header-anchor">#</a> 别名（alias）</h3> <p>是一个字段或值的替换名。别名用 AS 关键字赋予。别名有时也称为导出列（derived column），不管称为什么，它们所代表的都是相同的东西。</p> <h3 id="聚集函数-aggregate-function"><a href="#聚集函数-aggregate-function" class="header-anchor">#</a> 聚集函数（aggregate function）</h3> <p>运行在行组上，计算和返回单个值的函数。</p> <h3 id="查询-query"><a href="#查询-query" class="header-anchor">#</a> 查询（query）</h3> <p>任何 SQL 语句都是查询。但此术语一般指 SELECT 语句。</p> <h3 id="相关子查询-correlated-subquery"><a href="#相关子查询-correlated-subquery" class="header-anchor">#</a> 相关子查询（correlated subquery）</h3> <p>涉及外部查询的子查询。</p> <h3 id="可伸缩性-scale"><a href="#可伸缩性-scale" class="header-anchor">#</a> 可伸缩性（scale）</h3> <p>能够适应不断增加的工作量而不失败。设计良好的数据库或应用程序称之为可伸缩性好（scale well）</p> <h3 id="变量-variable"><a href="#变量-variable" class="header-anchor">#</a> 变量（variable）</h3> <p>内存中一个特定的位置，用来临时存储数据。所有 MySQL 变量都必须以 <code>@</code> 开始。</p> <h3 id="sql-structured-query-language"><a href="#sql-structured-query-language" class="header-anchor">#</a> SQL（Structured Query Language）</h3> <p><strong>SQL 是结构化查询语言（Structured Query Language）的缩写，是一种专门用来与数据库通信的语言。</strong></p> <p>SQL 的优点：</p> <ul><li>SQL 不是某个特定数据库供应商专有的语言。即 SQL 不是一种专利语言，而且存在一个标准委员会。几乎所有重要的 DBMS 都支持 SQL。</li> <li>SQL 简单易学。它的语句全都是由描述性很强的英语单词组成，而且这些单词的书目不多。</li> <li>SQL 尽管看上去很简单，但它实际上是一种强有力的语言，灵活使用其语言元素，可以进行非常复杂和高级的数据库操作。</li></ul> <h2 id="mysql-安装"><a href="#mysql-安装" class="header-anchor">#</a> MySQL 安装</h2> <p>推荐几个 MySQL 安装和连接的经验文章</p> <ul><li><a href="http://www.scienjus.com/install-mysql-on-mac/" target="_blank" rel="noopener noreferrer">在 Mac 下安装 MySQL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.jianshu.com/p/289d8ad3defa" target="_blank" rel="noopener noreferrer">mac 版 mysql 安装后显示 mysql: command not found 咋整？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="mysql-应用"><a href="#mysql-应用" class="header-anchor">#</a> MySQL 应用</h2> <h3 id="mysql-命令行"><a href="#mysql-命令行" class="header-anchor">#</a> mysql 命令行</h3> <ul><li>命令输入在 mysql&gt; 之后；</li> <li>命令用 ; 或 \g 结束，换句话说，仅按 Enter 不执行命令；</li> <li>输入 help 或 \h 获得帮助，也可以输入更多的文本获得特定命令的帮助（如，输入 help select 获得试用 SELECT 语句的帮助）；</li> <li>输入 quit 或 exit 退出命令行。</li></ul> <h3 id="连接数据库"><a href="#连接数据库" class="header-anchor">#</a> 连接数据库</h3> <p>连接数据库需要以下信息：</p> <ul><li>主机名（计算机名）——如果连接到本地 MySQL 服务器，为 localhost ;</li> <li>端口（如果使用默认端口 3306 之外的端口）；</li> <li>一个合法的用户名；</li> <li>用户口令（如果需要）</li></ul> <p>例如下面的指令：</p> <div class="language- extra-class"><pre class="language-text"><code>mysql -u root -h localhost -P 3306 -p
</code></pre></div><h3 id="数据库的登录和成员管理"><a href="#数据库的登录和成员管理" class="header-anchor">#</a> 数据库的登录和成员管理</h3> <h4 id="访问控制"><a href="#访问控制" class="header-anchor">#</a> 访问控制</h4> <p>MySQL 服务器的安全基础是：用户应该对他们需要的数据具有适当的访问权，既不能多也不能少。</p> <p>需要给用户提供他们所需的访问权，且仅提供他们所需的访问权。这就是所谓的<strong>访问控制</strong>。访问控制的目的不仅仅是防止用户的恶意企图，访问控制也有助于避免很常见的无意识错误的结果，如错打 MySQL 语句，在不合适的数据库中操作或其他一些用户错误。</p> <h4 id="管理用户"><a href="#管理用户" class="header-anchor">#</a> 管理用户</h4> <h5 id="查询已有用户"><a href="#查询已有用户" class="header-anchor">#</a> 查询已有用户</h5> <p>MySQL 用户账号和信息存储在名为 mysql 的 MySQL 数据库中。一般只有在需要获得所有用户账号列表时才会直接访问。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 输入</span>
<span class="token keyword">USE</span> mysql<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token keyword">user</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span><span class="token punctuation">;</span>

<span class="token comment"># 输出</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
<span class="token operator">|</span> <span class="token keyword">user</span>             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
<span class="token operator">|</span> test             <span class="token operator">|</span>
<span class="token operator">|</span> root             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
</code></pre></div><h5 id="创建用户账号"><a href="#创建用户账号" class="header-anchor">#</a> 创建用户账号</h5> <blockquote><p>1、使用 CREATE USER 语句（推荐）</p></blockquote> <p>CREATE USER '用户名'@'主机' IDENTIFIED BY '密码';</p> <ul><li>主机：指定该用户可以从哪些主机访问 MySQL（通常是本地或远程）。常见值：
<ul><li>'localhost'：只允许从本地访问。</li> <li>'%'：默认值，允许从任何主机访问。</li></ul></li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 输入</span>

<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'chenfangxu'</span><span class="token variable">@'localhost'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token keyword">user</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span><span class="token punctuation">;</span>

<span class="token comment">#输出</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
<span class="token operator">|</span> <span class="token keyword">user</span>             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
<span class="token operator">|</span> chenfangxu       <span class="token operator">|</span>
<span class="token operator">|</span> test             <span class="token operator">|</span>
<span class="token operator">|</span> root             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
</code></pre></div><blockquote><p>2、GRANT 语句也可以创建用户账号。（MySQL 8.0 以上的新版本已经将创建账户和赋予权限分开了，所以不能再用这种方法创建用户了）</p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># mysql8.0以下</span>
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> chenfangxu<span class="token variable">@'%'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>3、使用 INSERT 直接插入行到 user 表来增加用户（不建议）</p></blockquote> <h5 id="设置访问权限"><a href="#设置访问权限" class="header-anchor">#</a> 设置访问权限</h5> <p>在创建用户账号后，必须接着分配访问权限。新创建的用户账号没有访问权限。他们能登录 MySQL ，但不能看到数据，不能执行任何数据库操作。</p> <br> <blockquote><p><strong>查看赋予用户账号的权限</strong> <code>SHOW GRANTS FOR</code></p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 输入</span>
<span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> chenfangxu<span class="token punctuation">;</span>

<span class="token comment"># 输出</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------+</span>
<span class="token operator">|</span> Grants <span class="token keyword">for</span> chenfangxu@<span class="token operator">%</span>                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------+</span>
<span class="token operator">|</span> <span class="token keyword">GRANT</span> <span class="token keyword">USAGE</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token identifier"><span class="token punctuation">`</span>chenfangxu<span class="token punctuation">`</span></span><span class="token variable">@`%`</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------+</span>
</code></pre></div><p>权限 <code>USAGE ON *.*</code> ,USAGE 表示根本没有权限，这句话就是说在任意数据库和任意表上对任何东西没有权限。</p> <p><code>chenfangxu@%</code> 因为用户定义为 <code>user@host</code>, MySQL 的权限用用户名和主机名结合定义，如果不指定主机名，则使用默认的主机名<code>%</code>（即授予用户访问权限而不管主机名）。</p> <br> <blockquote><p><strong>添加（更新）用户权限</strong> <code>GRANT privileges ON databasename.tablename TO 'username'@'host';</code></p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 输入</span>
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> performance_schema<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> chenfangxu<span class="token variable">@'%'</span><span class="token punctuation">;</span>
<span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> chenfangxu@<span class="token operator">%</span><span class="token punctuation">;</span>

<span class="token comment"># 输出</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------------------------+</span>
<span class="token operator">|</span> Grants <span class="token keyword">for</span> chenfangxu@<span class="token operator">%</span>                                    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------------------------+</span>
<span class="token operator">|</span> <span class="token keyword">GRANT</span> <span class="token keyword">USAGE</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token identifier"><span class="token punctuation">`</span>chenfangxu<span class="token punctuation">`</span></span><span class="token variable">@`%`</span>                     <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> <span class="token identifier"><span class="token punctuation">`</span>performance_schema<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token identifier"><span class="token punctuation">`</span>chenfangxu<span class="token punctuation">`</span></span><span class="token variable">@`%`</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------------------------+</span>
</code></pre></div><br> <blockquote><p><strong>撤销用户的权限</strong> <code>REVOKE privileges ON databasename.tablename FROM 'username'@'host';</code></p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 输入</span>
<span class="token keyword">REVOKE</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> performance_schema<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> chenfangxu<span class="token variable">@'%'</span><span class="token punctuation">;</span>
<span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> chenfangxu<span class="token punctuation">;</span>

<span class="token comment">#输出</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------+</span>
<span class="token operator">|</span> Grants <span class="token keyword">for</span> chenfangxu@<span class="token operator">%</span>                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------+</span>
<span class="token operator">|</span> <span class="token keyword">GRANT</span> <span class="token keyword">USAGE</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token identifier"><span class="token punctuation">`</span>chenfangxu<span class="token punctuation">`</span></span><span class="token variable">@`%`</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------------+</span>
</code></pre></div><br> <h4 id="重命名"><a href="#重命名" class="header-anchor">#</a> 重命名</h4> <blockquote><p>重命名：<code>RENAME USER 'username' TO 'newusername';</code></p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 输入</span>
<span class="token keyword">RENAME</span> <span class="token keyword">USER</span> test <span class="token keyword">TO</span> test1<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token keyword">user</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span><span class="token punctuation">;</span>

<span class="token comment"># 输出</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
<span class="token operator">|</span> <span class="token keyword">user</span>             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
<span class="token operator">|</span> test1            <span class="token operator">|</span>
<span class="token operator">|</span> root             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
</code></pre></div><br> <h4 id="更改用户密码-mysql-8-0-11-后"><a href="#更改用户密码-mysql-8-0-11-后" class="header-anchor">#</a> 更改用户密码(mysql 8.0.11 后)</h4> <blockquote><p>更改用户密码：<code>SET PASSWORD FOR 'username'@'host' = 'newpassword';</code></p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> PASSWORD <span class="token keyword">FOR</span> chenfangxu<span class="token variable">@'%'</span> <span class="token operator">=</span> <span class="token string">'654321'</span><span class="token punctuation">;</span>

<span class="token comment"># 更改root密码</span>
<span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">'root'</span><span class="token variable">@'localhost'</span> IDENTIFIED <span class="token keyword">WITH</span> caching_sha2_password <span class="token keyword">BY</span> <span class="token string">'yourpasswd'</span><span class="token punctuation">;</span>
</code></pre></div><br> <h4 id="删除用户"><a href="#删除用户" class="header-anchor">#</a> 删除用户</h4> <blockquote><p>删除用户：<code>DROP USER 'username'@'host';</code></p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 输入</span>
<span class="token keyword">DROP</span> <span class="token keyword">USER</span> chenfangxu<span class="token variable">@'%'</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token keyword">user</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span><span class="token punctuation">;</span>

<span class="token comment">#输出</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
<span class="token operator">|</span> <span class="token keyword">user</span>             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
<span class="token operator">|</span> test             <span class="token operator">|</span>
<span class="token operator">|</span> root             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
</code></pre></div><p>MySQL 5 以前， DROP USER 只能用来删除用户账号，不能删除相关的权限。因此，如果使用旧版的 MySQL 需要先用 REVOKE 删除与账号相关的权限，然后再用 DROP USER 删除账号。</p> <hr> <br> <h3 id="操作数据库"><a href="#操作数据库" class="header-anchor">#</a> 操作数据库</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 创建数据库，如创建 learnsql 数据库</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> learnsql<span class="token punctuation">;</span>

<span class="token comment"># 选择数据库，如选择 learnsql 数据库</span>
<span class="token keyword">USE</span> learnsql<span class="token punctuation">;</span>

<span class="token comment"># 显示数据库列表</span>
<span class="token keyword">SHOW</span> <span class="token keyword">DATABASES</span><span class="token punctuation">;</span>

<span class="token comment"># 显示数据库内的表的列表</span>
<span class="token keyword">SHOW</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>

<span class="token comment"># 显示表中每一列的详细信息</span>
<span class="token keyword">SHOW</span> <span class="token keyword">COLUMNS</span> <span class="token keyword">FROM</span> customers<span class="token punctuation">;</span>
</code></pre></div><h4 id="describe-语句"><a href="#describe-语句" class="header-anchor">#</a> DESCRIBE 语句</h4> <p>MySQL 中 DESCRIBE 可以作为 SHOW COLUMNS FROM 的快捷方式。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 以下两种命令结果相同</span>
<span class="token keyword">SHOW</span> <span class="token keyword">COLUMNS</span> <span class="token keyword">FROM</span> customers<span class="token punctuation">;</span>
<span class="token keyword">DESCRIBE</span> customers<span class="token punctuation">;</span>
</code></pre></div><hr> <br> <h2 id="下面用到的数据库文件可在-mysql-scripts-找到。"><a href="#下面用到的数据库文件可在-mysql-scripts-找到。" class="header-anchor">#</a> 下面用到的数据库文件可在 <a href="https://github.com/qiqihaobenben/Front-End-Basics/tree/master/assistive-tools/database/mysql_scripts" target="_blank" rel="noopener noreferrer">mysql_scripts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 找到。</h2> <hr> <br> <h2 id="检索数据"><a href="#检索数据" class="header-anchor">#</a> 检索数据</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 检索单个列，例如从 products 表中检索一个名为 prod_name 的列。</span>
<span class="token keyword">SELECT</span> prod_name <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>

<span class="token comment"># 检索多个列。注意，列名之间要用逗号分隔，最后一个列名后不要加逗号，会报错。</span>
<span class="token keyword">SELECT</span> prod_id<span class="token punctuation">,</span> prod_name<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>

<span class="token comment"># 检索所有列。</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>

<span class="token comment"># 只检索出不同的行， DESTINCT 关键字可以让指令只返回不同的值。如果指令，products 表中可能一共有14行，现在只返回不同（唯一）的 vend_id 行，可能就只返回4行了。</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> vend_id <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>

<span class="token comment"># 限制结果， LIMIT 5 表示只返回不多于5行。</span>
<span class="token keyword">SELECT</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">LIMIT</span> <span class="token number">5</span><span class="token punctuation">;</span>

<span class="token comment"># LIMIT 5, 5 表示返回从行5开始的5行。</span>
<span class="token keyword">SELECT</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">LIMIT</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token comment"># 或者使用 LIMIT 5 OFFSET 5， 跟上面结果相同。</span>
<span class="token keyword">SELECT</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">LIMIT</span> <span class="token number">5</span> <span class="token keyword">OFFSET</span> <span class="token number">5</span><span class="token punctuation">;</span>

<span class="token comment"># 注意，返回行数是从 0 开始的。所以，LIMIT 1, 1 将检索出第二行，而不是第一行。</span>
<span class="token keyword">SELECT</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><hr> <br> <h2 id="排序检索数据-order-by"><a href="#排序检索数据-order-by" class="header-anchor">#</a> 排序检索数据 ( ORDER BY )</h2> <p>不使用排序时，其实检索出的数据并不是以纯粹的随机顺序显示的，数据一般将以它在底层表中出现的顺序显示。这可以是数据最初添加到表中的顺序，但是，如果数据后来进行过更新或者删除，则此顺序将会受到 MySQL 重用回收存储空间的影响。因此，如果不明确控制的话，不能（也不应该）依赖该排序顺序。</p> <p><strong>关系数据库设计理论认为：如果不明确规定排序顺序，则不应该假定检索出的数据的顺序有意义。</strong></p> <p>ORDER BY 子句，可以给 SELECT 语句检索出来的数据进行排序。 ORDER BY 子句取一个或多个列的名字。据此对输出进行排序。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 没有排序</span>
<span class="token keyword">SELECT</span> prod_name <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>

<span class="token comment"># 对 prod_name 列以字母顺序排序数据</span>
<span class="token keyword">SELECT</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_name<span class="token punctuation">;</span>

<span class="token comment"># 按多个列排序：如下会先按照 prod_price 排序，</span>
<span class="token comment"># 只有出现相同的 prod_price 时，才会再按照 prod_name 排序。</span>
<span class="token keyword">SELECT</span> prod_id<span class="token punctuation">,</span> prod_price<span class="token punctuation">,</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_price<span class="token punctuation">,</span> prod_name<span class="token punctuation">;</span>

<span class="token comment"># 指定排序方向，默认是升序，例如按照 prod_price 降序排序（最贵的排在最前面）</span>
<span class="token keyword">SELECT</span> prod_id<span class="token punctuation">,</span> prod_price<span class="token punctuation">,</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_price <span class="token keyword">DESC</span><span class="token punctuation">;</span>
<span class="token comment"># 多个列排序，例如按照 prod_price 降序，最贵的在最前面，然后在对产品名排序</span>
<span class="token keyword">SELECT</span> prod_id<span class="token punctuation">,</span> prod_price<span class="token punctuation">,</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_price <span class="token keyword">DESC</span><span class="token punctuation">,</span> prod_name<span class="token punctuation">;</span>

<span class="token comment"># ORDER BY 和 LIMIT 搭配，可以找出一个列中最高或最低的值。</span>
<span class="token keyword">SELECT</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_price <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="注意"><a href="#注意" class="header-anchor">#</a> 注意：</h3> <ul><li>ORDER BY 子句中使用的列不一定非得是检索的列，用非检索的列排序也是完全合法的。</li> <li>如果想在多个列上进行降序排序，必须对每个列指定 DESC 关键字。</li> <li>ASC 是升序排序，升序是默认的，不指定 DESC ，那就是按照 ASC 升序排序。</li> <li>ORDER BY 子句必须位于 FROM 子句之后，如果使用 LIMIT ，它必须位于 ORDER BY 之后。</li></ul> <hr> <br> <h2 id="过滤数据-where"><a href="#过滤数据-where" class="header-anchor">#</a> 过滤数据 （ WHERE ）</h2> <p>数据库包含大量的数据，但是我们很少需要检索表中所有的行。只检索所需数据需要指定过滤条件，在 SELECT 语句中，数据根据 WHERE 子句中指定的搜索条件进行过滤。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 检索 pro_price 为 2.50 的行</span>
<span class="token keyword">SELECT</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_price <span class="token operator">=</span> <span class="token number">2.50</span><span class="token punctuation">;</span>

<span class="token comment"># 执行筛选匹配时默认不区分大小写，所以 fuses 可以检索出 Fuses</span>
<span class="token keyword">SELECT</span> prod_name<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_name <span class="token operator">=</span> <span class="token string">'fuses'</span><span class="token punctuation">;</span>
<span class="token comment"># 输出</span>
<span class="token operator">+</span><span class="token comment">-----------+------------+</span>
<span class="token operator">|</span> prod_name <span class="token operator">|</span> prod_price <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+------------+</span>
<span class="token operator">|</span> Fuses     <span class="token operator">|</span>       <span class="token number">3.42</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+------------+</span>

<span class="token comment"># 检索出 vend_id 不等于 1003 的行</span>
<span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> vend_id <span class="token operator">&lt;&gt;</span> <span class="token number">1003</span><span class="token punctuation">;</span>

<span class="token comment"># 检索 prod_price 在 5 到 10 之间的所有行</span>
<span class="token keyword">SELECT</span> prod_name<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_price <span class="token operator">BETWEEN</span> <span class="token number">5</span> <span class="token operator">AND</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment"># 检查具有 NULL 值的列，用 IS NULL 子句</span>
<span class="token keyword">SELECT</span> cust_id <span class="token keyword">FROM</span> customers <span class="token keyword">WHERE</span> cust_email <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="where-子句操作符"><a href="#where-子句操作符" class="header-anchor">#</a> WHERE 子句操作符</h3> <table><thead><tr><th style="text-align:center;">操作符</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">=</td> <td style="text-align:center;">等于</td></tr> <tr><td style="text-align:center;">&lt;&gt;</td> <td style="text-align:center;">不等于</td></tr> <tr><td style="text-align:center;">!=</td> <td style="text-align:center;">不等于</td></tr> <tr><td style="text-align:center;">&lt;</td> <td style="text-align:center;">小于</td></tr> <tr><td style="text-align:center;">&lt;=</td> <td style="text-align:center;">小于等于</td></tr> <tr><td style="text-align:center;">&gt;</td> <td style="text-align:center;">大于</td></tr> <tr><td style="text-align:center;">&gt;=</td> <td style="text-align:center;">大于等于</td></tr> <tr><td style="text-align:center;">BETWEEN</td> <td style="text-align:center;">在指定的两个值之间</td></tr></tbody></table> <h3 id="注意-2"><a href="#注意-2" class="header-anchor">#</a> 注意：</h3> <ul><li>WHERE 语句的位置：在同时使用 ORDER BY 和 WHERE 子句时，应该让 ORDER BY 位于 WHERE 之后，否则将会产生错误。</li> <li>WHERE 子句中使用的条件，如果将值与串类型（例如字符串）比较，需要加引号，用来与数值列进行比较的值不用引号。</li> <li>NULL 无值(no value)，它与字段 0 、空字符串或仅仅包含空格不同。</li></ul> <hr> <br> <h2 id="数据过滤-and、-or、-in"><a href="#数据过滤-and、-or、-in" class="header-anchor">#</a> 数据过滤（ AND、 OR、 IN ）</h2> <p>MySQL 允许组合多个 WHERE 子句。这些子句分为两种方式使用：以 AND 子句的方式或 OR 子句的方式使用。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### AND 操作符</span>
<span class="token comment"># 检索出 vend_id 等于 1003 并且 prod_price 小于等于 10 的行</span>
<span class="token keyword">SELECT</span> prod_price<span class="token punctuation">,</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> vend_id <span class="token operator">=</span> <span class="token number">1003</span> <span class="token operator">AND</span> prod_price <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span>


<span class="token comment">#### OR 操作符</span>
<span class="token comment"># 检索出 vend_id 等于 1002 或 vend_id 等于 1003 的所有行</span>
<span class="token keyword">SELECT</span> prod_name<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> vend_id <span class="token operator">=</span> <span class="token number">1002</span> <span class="token operator">OR</span> vend_id <span class="token operator">=</span> <span class="token number">1003</span><span class="token punctuation">;</span>


<span class="token comment"># AND 和 OR 合用，AND 优先级高。</span>
<span class="token comment"># 下面检索出的结果是 vend_id 是 1003 并且 prod_price 大于等于 10 的和所有 vend_id 是 1002 的行。</span>
<span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_name<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> vend_id <span class="token operator">=</span> <span class="token number">1002</span> <span class="token operator">OR</span> vend_id <span class="token operator">=</span> <span class="token number">1003</span> <span class="token operator">AND</span> prod_price <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token comment"># 输出结果</span>
<span class="token operator">+</span><span class="token comment">---------+----------------+------------+</span>
<span class="token operator">|</span> vend_id <span class="token operator">|</span> prod_name      <span class="token operator">|</span> prod_price <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+----------------+------------+</span>
<span class="token operator">|</span>    <span class="token number">1002</span> <span class="token operator">|</span> Fuses          <span class="token operator">|</span>       <span class="token number">3.42</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">1002</span> <span class="token operator">|</span> Oil can        <span class="token operator">|</span>       <span class="token number">8.99</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">1003</span> <span class="token operator">|</span> Detonator      <span class="token operator">|</span>      <span class="token number">13.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">1003</span> <span class="token operator">|</span> Bird seed      <span class="token operator">|</span>      <span class="token number">10.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">1003</span> <span class="token operator">|</span> Safe           <span class="token operator">|</span>      <span class="token number">50.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">1003</span> <span class="token operator">|</span> TNT <span class="token punctuation">(</span><span class="token number">5</span> sticks<span class="token punctuation">)</span> <span class="token operator">|</span>      <span class="token number">10.00</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+----------------+------------+</span>

<span class="token comment"># 如果想检索出 vend_id 是 1003 并且 prod_price 大于等于 10 的和 vend_id 是 1002  并且 prod_price 大于等于 10 的行，需要加括号。</span>
<span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_name<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>vend_id <span class="token operator">=</span> <span class="token number">1002</span> <span class="token operator">OR</span> vend_id <span class="token operator">=</span> <span class="token number">1003</span><span class="token punctuation">)</span> <span class="token operator">AND</span> prod_price <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">;</span>


<span class="token comment">### IN 操作符，指定条件范围，范围中的每个条件都可以进行匹配。IN 取值是全部括在圆括号中的由逗号分隔的列表。</span>
<span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_name<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> vend_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1002</span><span class="token punctuation">,</span> <span class="token number">1003</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">### NOT 操作符，否定它之后的任何条件</span>
<span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_name<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> vend_id <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1002</span><span class="token punctuation">,</span> <span class="token number">1003</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="注意-3"><a href="#注意-3" class="header-anchor">#</a> 注意</h3> <ul><li>WHERE 可包含任意数目的 AND 和 OR 操作符，并且允许两者结合以进行复杂和高效的过滤。不过 SQL 语言在处理 OR 操作符前，会优先处理 AND 操作符。</li> <li>任何时候使用具有 AND 和 OR 操作符的 WHERE 子句， 都推荐使用圆括号明确地分组，不要过分依赖默认计算次序。</li> <li>IN 和 OR 具有相同的功能，但是 IN 操作符有以下优点
<ul><li>过滤的字段太多的时候，IN 操作符的语法更清楚且更直观</li> <li>IN 操作符一般比 OR 操作符执行的更快</li> <li>IN 最大的优点是可以包含其他 SELECT 语句，能更动态地建立 WHERE 子句。</li></ul></li> <li>MySQL 支持使用 NOT 对 IN、BETWEEN 和 EXISTS 子句取反。</li></ul> <hr> <br> <h2 id="用通配符过滤"><a href="#用通配符过滤" class="header-anchor">#</a> 用通配符过滤</h2> <h3 id="百分号-通配符"><a href="#百分号-通配符" class="header-anchor">#</a> 百分号（%）通配符</h3> <p><code>%</code> 表示任何字符出现任意次数，可以使 0 次，1 次，n 次</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 找出所有以 jet 开头的产品</span>
<span class="token keyword">SELECT</span> prod_id<span class="token punctuation">,</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_name <span class="token operator">LIKE</span> <span class="token string">'jet%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+--------------+</span>
<span class="token operator">|</span> prod_id <span class="token operator">|</span> prod_name    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+--------------+</span>
<span class="token operator">|</span> JP1000  <span class="token operator">|</span> JetPack <span class="token number">1000</span> <span class="token operator">|</span>
<span class="token operator">|</span> JP2000  <span class="token operator">|</span> JetPack <span class="token number">2000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+--------------+</span>

<span class="token comment">### 通配符可在搜索模式中任意位置使用，并且可以使用多个通配符。</span>
<span class="token keyword">SELECT</span> prod_id<span class="token punctuation">,</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_name <span class="token operator">LIKE</span> <span class="token string">'%anvil%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+--------------+</span>
<span class="token operator">|</span> prod_id <span class="token operator">|</span> prod_name    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+--------------+</span>
<span class="token operator">|</span> ANV01   <span class="token operator">|</span> <span class="token number">.5</span> ton anvil <span class="token operator">|</span>
<span class="token operator">|</span> ANV02   <span class="token operator">|</span> <span class="token number">1</span> ton anvil  <span class="token operator">|</span>
<span class="token operator">|</span> ANV03   <span class="token operator">|</span> <span class="token number">2</span> ton anvil  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+--------------+</span>

</code></pre></div><h3 id="下划线通配符"><a href="#下划线通配符" class="header-anchor">#</a> 下划线通配符</h3> <p>下划线 _ 只能匹配单个字符，只能匹配一个，不能多也不能少。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 对比一下下面两个通配符结果</span>
<span class="token keyword">SELECT</span> prod_id<span class="token punctuation">,</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_name <span class="token operator">LIKE</span> <span class="token string">'_ ton anvil'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+-------------+</span>
<span class="token operator">|</span> prod_id <span class="token operator">|</span> prod_name   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-------------+</span>
<span class="token operator">|</span> ANV02   <span class="token operator">|</span> <span class="token number">1</span> ton anvil <span class="token operator">|</span>
<span class="token operator">|</span> ANV03   <span class="token operator">|</span> <span class="token number">2</span> ton anvil <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-------------+</span>


<span class="token keyword">SELECT</span> prod_id<span class="token punctuation">,</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_name <span class="token operator">LIKE</span> <span class="token string">'% ton anvil'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+--------------+</span>
<span class="token operator">|</span> prod_id <span class="token operator">|</span> prod_name    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+--------------+</span>
<span class="token operator">|</span> ANV01   <span class="token operator">|</span> <span class="token number">.5</span> ton anvil <span class="token operator">|</span>
<span class="token operator">|</span> ANV02   <span class="token operator">|</span> <span class="token number">1</span> ton anvil  <span class="token operator">|</span>
<span class="token operator">|</span> ANV03   <span class="token operator">|</span> <span class="token number">2</span> ton anvil  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+--------------+</span>

<span class="token comment">### 下划线通配符比百分号通配符少了一个 .5 的数据</span>
</code></pre></div><h3 id="注意-4"><a href="#注意-4" class="header-anchor">#</a> 注意</h3> <ul><li>注意尾部空格，例如'%anvil' 是匹配不到 'anvil ',因为后面有个空格不容易发现，解决方法就是后面再附加一个 % ，或者用函数去掉首尾空格。</li> <li>% 是不能匹配出 NULL 的。</li> <li>通配符搜索的处理一般要比其他搜索花时间更长，所以不要过度使用通配符，如果其他操作符能达到同样的目的，优先使用其他操作符。在确实需要使用通配符时，除非绝对有必要，否则不要把他们用在搜索模式的开始处。</li></ul> <hr> <br> <h2 id="用正则表达式进行搜索"><a href="#用正则表达式进行搜索" class="header-anchor">#</a> 用正则表达式进行搜索</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 基本字符匹配，下面的语句检索列 prod_name 包含文本 1000 的所有行。</span>
<span class="token keyword">SELECT</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_name <span class="token operator">REGEXP</span> <span class="token string">'1000'</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_name<span class="token punctuation">;</span>

<span class="token comment">### 区分大小写需要用到 BINARY 关键字</span>
<span class="token keyword">SELECT</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_name <span class="token operator">REGEXP</span> <span class="token keyword">BINARY</span> <span class="token string">'S'</span><span class="token punctuation">;</span>

<span class="token comment">### 使用 | 进行 OR 匹配，可以有两个以上的 OR 条件，例如： '1000|2000|3000'</span>
<span class="token keyword">SELECT</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_name <span class="token operator">REGEXP</span> <span class="token string">'1000|2000'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
<span class="token operator">|</span> prod_name    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
<span class="token operator">|</span> JetPack <span class="token number">1000</span> <span class="token operator">|</span>
<span class="token operator">|</span> JetPack <span class="token number">2000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>

<span class="token comment">### 匹配几个字符之一</span>
<span class="token keyword">SELECT</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_name <span class="token operator">REGEXP</span> <span class="token string">'[1,2,3] Ton'</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_name<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token operator">|</span> prod_name   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token operator">|</span> <span class="token number">1</span> ton anvil <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span> ton anvil <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token comment">### 注意区别 1|2|3 Ton，这表示匹配出 1，2和3 Ton，其实[123]是[1|2|3]的缩写</span>
<span class="token keyword">SELECT</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_name <span class="token operator">REGEXP</span> <span class="token string">'1|2|3 Ton'</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_name<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token operator">|</span> prod_name     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token operator">|</span> <span class="token number">1</span> ton anvil   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span> ton anvil   <span class="token operator">|</span>
<span class="token operator">|</span> JetPack <span class="token number">1000</span>  <span class="token operator">|</span>
<span class="token operator">|</span> JetPack <span class="token number">2000</span>  <span class="token operator">|</span>
<span class="token operator">|</span> TNT <span class="token punctuation">(</span><span class="token number">1</span> stick<span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>

<span class="token comment">### 匹配特殊字符， \\ 来转义特殊字符</span>
<span class="token keyword">SELECT</span> vend_name <span class="token keyword">FROM</span> vendors <span class="token keyword">WHERE</span> vend_name <span class="token operator">REGEXP</span> <span class="token string">'\\.'</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> vend_name<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
<span class="token operator">|</span> vend_name    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
<span class="token operator">|</span> Furball Inc<span class="token punctuation">.</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>


<span class="token comment">### 匹配出连在一起的4个数字</span>
<span class="token keyword">SELECT</span> prod_name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_name <span class="token operator">REGEXP</span> <span class="token string">'[:digit:]{4}'</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> prod_name<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
<span class="token operator">|</span> prod_name    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
<span class="token operator">|</span> JetPack <span class="token number">1000</span> <span class="token operator">|</span>
<span class="token operator">|</span> JetPack <span class="token number">2000</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
</code></pre></div><h3 id="列举元字符转义和定位元字符"><a href="#列举元字符转义和定位元字符" class="header-anchor">#</a> 列举元字符转义和定位元字符</h3> <table><thead><tr><th>元字符</th> <th>说明</th></tr></thead> <tbody><tr><td>\f</td> <td>换页</td></tr> <tr><td>\n</td> <td>换行</td></tr> <tr><td>\r</td> <td>回车</td></tr> <tr><td>\t</td> <td>制表</td></tr> <tr><td>\v</td> <td>纵向制表</td></tr> <tr><td>\\</td> <td>反斜杠</td></tr> <tr><td>^</td> <td>文本的开始</td></tr> <tr><td>$</td> <td>文本的结束</td></tr> <tr><td>[[:&lt;:]](8 版本之后改为 \b)</td> <td>词的开始</td></tr> <tr><td>[[:&gt;:]](8 版本之后改为 \b)</td> <td>词的结束</td></tr></tbody></table> <p>多数正则表达式实现使用单个反斜杠转义特殊字符，以便能使用这些字符本身。但 MySQL 要求两个反斜杠（MySQL 自己解释一个，正则表达式库解释另一个）。</p> <h3 id="列举字符类"><a href="#列举字符类" class="header-anchor">#</a> 列举字符类</h3> <table><thead><tr><th>类</th> <th>说明</th></tr></thead> <tbody><tr><td>[:alnum:]</td> <td>任意字符和数字（同 [a-zA-Z0-9]）</td></tr> <tr><td>[:alpha:]</td> <td>任意字符（同 [a-zA-Z]）</td></tr> <tr><td>[:blank:]</td> <td>空格和制表 （同 [\t]）</td></tr> <tr><td>[:cntrl:]</td> <td>ASCII 控制字符 （ASCII 0 到 31 和 127）</td></tr> <tr><td>[:digit:]</td> <td>任意数字 （同 [0-9]）</td></tr> <tr><td>[:xdigit:]</td> <td>任意十六进制数字（同 [a-fA-F0-9]）</td></tr> <tr><td>[:lower:]</td> <td>任意小写字母 （同 [a-z]）</td></tr> <tr><td>[:upper:]</td> <td>任意大写字母（同 [A-Z]）</td></tr> <tr><td>[:print:]</td> <td>任意可打印字符</td></tr> <tr><td>[:graph:]</td> <td>与[:print:]相同，但不包含空格</td></tr> <tr><td>[:punct:]</td> <td>既不在[:alnum:]又不在[:cntrl:]中的任意字符</td></tr> <tr><td>[:space:]</td> <td>包括空格在内的任意空白字符(同 [\f\n\r\t\v])</td></tr></tbody></table> <h3 id="简单的正则表达式测试"><a href="#简单的正则表达式测试" class="header-anchor">#</a> 简单的正则表达式测试</h3> <p>在不使用数据库表的情况下用 SELECT 来测试正则表达式。 REGEXP 检查总是返回 0（没有匹配）或 1（匹配）。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token string">'hello'</span> <span class="token operator">REGEXP</span> <span class="token string">'hello\\b'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------------+</span>
<span class="token operator">|</span> <span class="token string">'hello'</span> <span class="token operator">REGEXP</span> <span class="token string">'hello\\b'</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------+</span>
<span class="token operator">|</span>                         <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------------+</span>
</code></pre></div><hr> <br> <h2 id="计算字段"><a href="#计算字段" class="header-anchor">#</a> 计算字段</h2> <div class="language-sql extra-class"><pre class="language-sql"><code>
<span class="token comment">### 将查出来的名字和国家拼接出来展示，使用了 Concat、Trim函数，和 AS 关键字</span>
<span class="token keyword">SELECT</span> Concat<span class="token punctuation">(</span> Trim<span class="token punctuation">(</span>vend_name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'('</span><span class="token punctuation">,</span> Trim<span class="token punctuation">(</span>vend_country<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">')'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> vend_name <span class="token keyword">FROM</span> vendors <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> vend_name<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------------+</span>
<span class="token operator">|</span> vend_name              <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------+</span>
<span class="token operator">|</span> ACME<span class="token punctuation">(</span>USA<span class="token punctuation">)</span>              <span class="token operator">|</span>
<span class="token operator">|</span> Anvils R Us<span class="token punctuation">(</span>USA<span class="token punctuation">)</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Furball Inc<span class="token punctuation">.</span><span class="token punctuation">(</span>USA<span class="token punctuation">)</span>      <span class="token operator">|</span>
<span class="token operator">|</span> Jet <span class="token keyword">Set</span><span class="token punctuation">(</span>England<span class="token punctuation">)</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Jouets Et Ours<span class="token punctuation">(</span>France<span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">|</span> LT Supplies<span class="token punctuation">(</span>USA<span class="token punctuation">)</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------+</span>


<span class="token comment">### 将20005订单中的所有物品查出来，通过数量和单价算出总价</span>
<span class="token keyword">SELECT</span> prod_id<span class="token punctuation">,</span> quantity<span class="token punctuation">,</span> item_price<span class="token punctuation">,</span> quantity<span class="token operator">*</span>item_price <span class="token keyword">AS</span> expanded_price <span class="token keyword">FROM</span> orderitems <span class="token keyword">WHERE</span> order_num <span class="token operator">=</span> <span class="token number">20005</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+----------+------------+----------------+</span>
<span class="token operator">|</span> prod_id <span class="token operator">|</span> quantity <span class="token operator">|</span> item_price <span class="token operator">|</span> expanded_price <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+----------+------------+----------------+</span>
<span class="token operator">|</span> ANV01   <span class="token operator">|</span>       <span class="token number">10</span> <span class="token operator">|</span>       <span class="token number">5.99</span> <span class="token operator">|</span>          <span class="token number">59.90</span> <span class="token operator">|</span>
<span class="token operator">|</span> ANV02   <span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span>       <span class="token number">9.99</span> <span class="token operator">|</span>          <span class="token number">29.97</span> <span class="token operator">|</span>
<span class="token operator">|</span> TNT2    <span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span>      <span class="token number">10.00</span> <span class="token operator">|</span>          <span class="token number">50.00</span> <span class="token operator">|</span>
<span class="token operator">|</span> FB      <span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span>      <span class="token number">10.00</span> <span class="token operator">|</span>          <span class="token number">10.00</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+----------+------------+----------------+</span>
</code></pre></div><h3 id="测试计算"><a href="#测试计算" class="header-anchor">#</a> 测试计算</h3> <p>SELECT 提供了测试和实验函数与计算的一个很好的方法，就是省略 FROM 子句</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token number">3</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----+</span>
<span class="token operator">|</span> <span class="token number">3</span><span class="token operator">*</span><span class="token number">2</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----+</span>
<span class="token operator">|</span>   <span class="token number">6</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----+</span>

<span class="token keyword">SELECT</span> <span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token operator">|</span> <span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>               <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
<span class="token operator">|</span> <span class="token number">2019</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">21</span> <span class="token number">22</span>:<span class="token number">51</span>:<span class="token number">13</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------------+</span>
</code></pre></div><hr> <br> <h2 id="使用数据处理函数"><a href="#使用数据处理函数" class="header-anchor">#</a> 使用数据处理函数</h2> <p>函数没有 SQL 的可移植性强，几乎每种主要的 DBMS 的实现都支持其他实现不支持的函数，有时差异还很大。为了代码的可移植性，很多人不赞成使用特殊实现的功能，虽然这样做很有好处，但是对于应用程序的性能可能出现影响。如果决定使用函数，应该保证做好代码注释。</p> <h3 id="文本处理函数"><a href="#文本处理函数" class="header-anchor">#</a> 文本处理函数</h3> <table><thead><tr><th>函 数</th> <th>说 明</th></tr></thead> <tbody><tr><td>Left()</td> <td>返回串左边的字符</td></tr> <tr><td>Length()</td> <td>返回串的长度</td></tr> <tr><td>Locate()</td> <td>找出串的一个子串</td></tr> <tr><td>Lower()</td> <td>将串转换为小写</td></tr> <tr><td>LTrim()</td> <td>去掉串左边的空格</td></tr> <tr><td>Right()</td> <td>返回串右边的字符</td></tr> <tr><td>RTrim()</td> <td>去掉串右边的空格</td></tr> <tr><td>Soundex()</td> <td>返回串的 SOUNDEX 值</td></tr> <tr><td>SubString()</td> <td>返回子串的字符</td></tr> <tr><td>Upper()</td> <td>将串转换为大写</td></tr></tbody></table> <p>SOUNDEX 是一个将任何文本串转换为描述其语音表示的字母数字模式的算法。SOUNDEX 考虑了类似的发音字节和音节，使得能对串进行发音比较而不是字母比较。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 例如用 Y. Lie 把 Y Lee 搜出来，因为它们发音类似</span>
<span class="token keyword">SELECT</span> cust_name<span class="token punctuation">,</span> cust_contact <span class="token keyword">FROM</span> customers <span class="token keyword">WHERE</span> Soundex<span class="token punctuation">(</span>cust_contact<span class="token punctuation">)</span> <span class="token operator">=</span> Soundex<span class="token punctuation">(</span><span class="token string">'Y. Lie'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------+--------------+</span>
<span class="token operator">|</span> cust_name   <span class="token operator">|</span> cust_contact <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+--------------+</span>
<span class="token operator">|</span> Coyote Inc<span class="token punctuation">.</span> <span class="token operator">|</span> Y Lee        <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+--------------+</span>
</code></pre></div><h3 id="日期和时间处理函数"><a href="#日期和时间处理函数" class="header-anchor">#</a> 日期和时间处理函数</h3> <table><thead><tr><th>函 数</th> <th>说 明</th></tr></thead> <tbody><tr><td>AddDate()</td> <td>增加一个日期（天、周等）</td></tr> <tr><td>AddTime()</td> <td>增加一个时间（时、分等）</td></tr> <tr><td>CurDate()</td> <td>返回当前日期</td></tr> <tr><td>CurTime()</td> <td>返回当前时间</td></tr> <tr><td>Date()</td> <td>返回日期时间的日期部分</td></tr> <tr><td>DateDiff()</td> <td>计算两个日期之差</td></tr> <tr><td>Date_Add()</td> <td>高度灵活的日期运算函数</td></tr> <tr><td>Date_Format()</td> <td>返回一个格式化的日期或时间串</td></tr> <tr><td>Year()</td> <td>返回一个日期的年份部分</td></tr> <tr><td>Month()</td> <td>返回一个日期的月份部分</td></tr> <tr><td>Day()</td> <td>返回一个日期的天数部分</td></tr> <tr><td>DayOfWeek()</td> <td>对于一个日期，返回对应的星期几</td></tr> <tr><td>Hour()</td> <td>返回一个时间的小时部分</td></tr> <tr><td>Minute()</td> <td>返回一个时间的分钟部分</td></tr> <tr><td>Second()</td> <td>返回一个时间的秒部分</td></tr> <tr><td>Now()</td> <td>返回当前日期和时间</td></tr></tbody></table> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 检索出日期为 2005-09-01 这天的订单记录</span>
<span class="token keyword">SELECT</span> cust_id<span class="token punctuation">,</span> order_num <span class="token keyword">FROM</span> orders <span class="token keyword">WHERE</span> order_date <span class="token operator">=</span> <span class="token string">'2005-09-01'</span><span class="token punctuation">;</span>


<span class="token comment">### 上面的检索有个问题，如果 order_date 存储的带有时间，例如 2005-09-01 11:30:05 ，就检索不到了，解决办法是让仅将给出的日期与列中的日期部分进行比较</span>
<span class="token keyword">SELECT</span> cust_id<span class="token punctuation">,</span> order_num <span class="token keyword">FROM</span> orders <span class="token keyword">WHERE</span> <span class="token keyword">Date</span><span class="token punctuation">(</span>order_date<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'2005-09-01'</span><span class="token punctuation">;</span>

<span class="token comment">### 如果想检索出2005年9月的所有订单</span>

<span class="token comment">### 方法一，得记住每个月有多少天，甚至要知道是不是闰年的2月</span>
<span class="token keyword">SELECT</span> cust_id<span class="token punctuation">,</span> order_num <span class="token keyword">FROM</span> orders <span class="token keyword">WHERE</span> <span class="token keyword">Date</span><span class="token punctuation">(</span>order_date<span class="token punctuation">)</span> <span class="token operator">BETWEEN</span> <span class="token string">'2005-09-01'</span> <span class="token operator">AND</span> <span class="token string">'2005-09-30'</span><span class="token punctuation">;</span>

<span class="token comment">### 方法二, 使用 Year() 和 Month() 函数</span>
<span class="token keyword">SELECT</span> cust_id<span class="token punctuation">,</span> order_num <span class="token keyword">FROM</span> orders <span class="token keyword">WHERE</span> <span class="token keyword">Year</span><span class="token punctuation">(</span>order_date<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2005</span> <span class="token operator">AND</span> <span class="token keyword">Month</span><span class="token punctuation">(</span>order_date<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>

</code></pre></div><h4 id="注意-5"><a href="#注意-5" class="header-anchor">#</a> 注意</h4> <ul><li>使用日期过滤，日期必须为 yyyy-mm-dd ,这样能排除一些歧义，年份也应该使用 4 位数字，更加可靠。</li></ul> <h3 id="数值处理函数"><a href="#数值处理函数" class="header-anchor">#</a> 数值处理函数</h3> <table><thead><tr><th>函 数</th> <th>说 明</th></tr></thead> <tbody><tr><td>Abs()</td> <td>返回一个数的绝对值</td></tr> <tr><td>Sin()</td> <td>返回一个角度的正弦</td></tr> <tr><td>Cos()</td> <td>返回一个角度的余弦</td></tr> <tr><td>Tan()</td> <td>返回一个角度的正切</td></tr> <tr><td>Exp()</td> <td>返回一个数的指数值</td></tr> <tr><td>Mod()</td> <td>返回除操作的余数</td></tr> <tr><td>Pi()</td> <td>返回圆周率</td></tr> <tr><td>Rand()</td> <td>返回一个随机数</td></tr> <tr><td>Sqrt()</td> <td>返回一个数的平方根</td></tr></tbody></table> <hr> <br> <h2 id="汇总数据"><a href="#汇总数据" class="header-anchor">#</a> 汇总数据</h2> <table><thead><tr><th>函 数</th> <th>说 明</th></tr></thead> <tbody><tr><td>AVG()</td> <td>返回某列的平均值</td></tr> <tr><td>COUNT()</td> <td>返回某列的行数</td></tr> <tr><td>MAX()</td> <td>返回某列的最大值</td></tr> <tr><td>MIN()</td> <td>返回某列的最小值</td></tr> <tr><td>SUM()</td> <td>返回某列值之和</td></tr></tbody></table> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 计算出 products 表中所有产品的平均价格</span>
<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> avg_price <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------+</span>
<span class="token operator">|</span> avg_price <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+</span>
<span class="token operator">|</span> <span class="token number">16.133571</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+</span>

<span class="token comment">### 查看 customers 表中所有客户的总数</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num_cust <span class="token keyword">FROM</span> customers<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span> num_cust <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token comment">### 只对具有电子邮件地址的客户计数</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>cust_email<span class="token punctuation">)</span> <span class="token keyword">AS</span> num_cust <span class="token keyword">FROM</span> customers<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span> num_cust <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>

<span class="token comment">### 计算出订单号为 20005 的物品总数</span>
<span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>quantity<span class="token punctuation">)</span> <span class="token keyword">AS</span> items_ordered <span class="token keyword">FROM</span> orderitems <span class="token keyword">WHERE</span> order_num <span class="token operator">=</span> <span class="token number">20005</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token operator">|</span> items_ordered <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token operator">|</span>            <span class="token number">19</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>

<span class="token comment">### 多个聚集函数组合</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num_items<span class="token punctuation">,</span> <span class="token function">MIN</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> price_min<span class="token punctuation">,</span> <span class="token function">MAX</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> price_max<span class="token punctuation">,</span> <span class="token function">AVG</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> price_avg <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------+-----------+-----------+-----------+</span>
<span class="token operator">|</span> num_items <span class="token operator">|</span> price_min <span class="token operator">|</span> price_max <span class="token operator">|</span> price_avg <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+-----------+-----------+-----------+</span>
<span class="token operator">|</span>        <span class="token number">14</span> <span class="token operator">|</span>      <span class="token number">2.50</span> <span class="token operator">|</span>     <span class="token number">55.00</span> <span class="token operator">|</span> <span class="token number">16.133571</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+-----------+-----------+-----------+</span>
</code></pre></div><h3 id="参数-all-和-distinct"><a href="#参数-all-和-distinct" class="header-anchor">#</a> 参数 ALL 和 DISTINCT</h3> <p>使用 DISTINCT 参数时，只会计算包含不同的值的行，如果指定参数为 ALL 或者不指定参数，默认参数为 ALL ，会计算所有的行。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 看一下产品表里有多少家供应商，因为有可能一家供应商提供很多产品。</span>
<span class="token comment">### 全部的行</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>vend_id<span class="token punctuation">)</span> <span class="token keyword">AS</span> vend_count <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------+</span>
<span class="token operator">|</span> vend_count <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------+</span>
<span class="token operator">|</span>         <span class="token number">14</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------+</span>
<span class="token comment">### 去重后就知道有 4 家供应商</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> vend_id<span class="token punctuation">)</span> <span class="token keyword">AS</span> vend_count <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------+</span>
<span class="token operator">|</span> vend_count <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------+</span>
<span class="token operator">|</span>          <span class="token number">4</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------+</span>
</code></pre></div><h3 id="注意-6"><a href="#注意-6" class="header-anchor">#</a> 注意</h3> <ul><li>AVG() 只能用来确定 <strong>单个</strong> 特定数值列的平均值，而且列名必须作为函数参数传入，想获取多个列的平均值，必须使用多个 AVG() 函数。</li> <li>AVG() 函数忽略列值为 NULL 的行。</li> <li>COUNT(*) 对表中行的数目进行计数， 不管列中是空值（NULL）还是非空值。</li> <li>使用 COUNT(column) 对特定列中具有值的行进行计数，会忽略 NULL 值。</li> <li>MAX() 函数会忽略值为 NULL 的行（MIN()也是）。它一般是用来找出最大的数值和日期值，但是也可以对非数值的数据使用，例如返回文本列中的最大值，MAX() 会返回最后一行（MIN
() 会返回第一行）。</li> <li>SUM() 函数会忽略值为 NULL 的行</li> <li>在表示某个聚集函数的结果时，不应该使用表中实际的列明，最好是指定别名，这样便于理解和使用。</li></ul> <hr> <br> <h2 id="分组数据"><a href="#分组数据" class="header-anchor">#</a> 分组数据</h2> <h3 id="数据分组"><a href="#数据分组" class="header-anchor">#</a> 数据分组</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> vend_id<span class="token punctuation">,</span> prod_price<span class="token punctuation">;</span>
</code></pre></div><ul><li>GROUP BY 子句后面可以加多个列。</li> <li>SELECT 子句中的列名必须为分组列或列函数（聚集计算语句除外），例如 按照 vend_id, prod_price 分组，SELECT 后面检索的列必须是 vend_id, prod_price。</li> <li>列函数对于 GROUP BY 子句定义的每个组各返回一个结果，例如取最大值时，就是每个组的最大值。</li> <li>如果分组列中有 NULL 值，则 NULL 将作为一个分组返回，如果列中有多行 NULL 值，它们将分为一组。</li> <li>GROUP BY 子句必须在 WHERE 子句之后， ORDER BY 子句之前。</li></ul> <h3 id="过滤分组"><a href="#过滤分组" class="header-anchor">#</a> 过滤分组</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 列出至少有两个订单的所有顾客</span>
<span class="token keyword">SELECT</span> cust_id<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> orders <span class="token keyword">FROM</span> orders <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> cust_id <span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token comment">### 列出具有2个（含）以上、价格为10（含）以上的产品的供应商</span>
<span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num_prods <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_price <span class="token operator">&gt;=</span> <span class="token number">10</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> vend_id <span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token comment">### 列出总计订单价格大于等于50的订单，并按照总价排序</span>
<span class="token keyword">SELECT</span> order_num<span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>quantity<span class="token operator">*</span>item_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> ordertotal <span class="token keyword">FROM</span> orderitems <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> order_num <span class="token keyword">HAVING</span> <span class="token function">SUM</span><span class="token punctuation">(</span>quantity<span class="token operator">*</span>item_price<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">50</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> ordertotal<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------+------------+</span>
<span class="token operator">|</span> order_num <span class="token operator">|</span> ordertotal <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+------------+</span>
<span class="token operator">|</span>     <span class="token number">20006</span> <span class="token operator">|</span>      <span class="token number">55.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token number">20008</span> <span class="token operator">|</span>     <span class="token number">125.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token number">20005</span> <span class="token operator">|</span>     <span class="token number">149.87</span> <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token number">20007</span> <span class="token operator">|</span>    <span class="token number">1000.00</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+------------+</span>
</code></pre></div><ul><li>HAVING 跟 WHERE 类似，但是 WHERE 在数据分组前进行过滤，HAVING 在数据分组后进行过滤。</li></ul> <h3 id="select-子句顺序"><a href="#select-子句顺序" class="header-anchor">#</a> SELECT 子句顺序</h3> <p>SELECT &gt; FROM &gt; WHERE &gt; GROUP BY &gt; HAVING &gt; ORDER BY &gt; LIMIT</p> <hr> <br> <h2 id="使用子查询"><a href="#使用子查询" class="header-anchor">#</a> 使用子查询</h2> <p>假设要列出订购物品 TNT2 的所有客户。我们可以拆分出下面三步。</p> <ol><li>检索包含物品 TNT2 的所有订单的编号。</li> <li>检索具有前一步骤列出的订单编号的所有客户的 ID。</li> <li>检索前一步骤返回的所有客户 ID 的客户信息。</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> cust_name<span class="token punctuation">,</span> cust_contact <span class="token keyword">FROM</span> customers
<span class="token keyword">WHERE</span> cust_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> cust_id <span class="token keyword">FROM</span> orders
<span class="token keyword">WHERE</span> order_num <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> order_num <span class="token keyword">FROM</span> orderitems <span class="token keyword">WHERE</span> prod_id <span class="token operator">=</span> <span class="token string">'TNT2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------+--------------+</span>
<span class="token operator">|</span> cust_name      <span class="token operator">|</span> cust_contact <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+--------------+</span>
<span class="token operator">|</span> Coyote Inc<span class="token punctuation">.</span>    <span class="token operator">|</span> Y Lee        <span class="token operator">|</span>
<span class="token operator">|</span> Yosemite Place <span class="token operator">|</span> Y Sam        <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+--------------+</span>
</code></pre></div><p>假设需要显示 customers 表中每个客户的订单总数，我们可以查分出下面两步。</p> <ol><li>从 customers 表中检索客户列表。</li> <li>对于检索出的每个客户，统计其在 orders 表中的订单数目。</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> cust_name<span class="token punctuation">,</span> cust_contact<span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> orders <span class="token keyword">WHERE</span> orders<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> customers<span class="token punctuation">.</span>cust_id<span class="token punctuation">)</span> <span class="token keyword">AS</span> orders
<span class="token keyword">FROM</span> customers <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> cust_name<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------+--------------+--------+</span>
<span class="token operator">|</span> cust_name      <span class="token operator">|</span> cust_contact <span class="token operator">|</span> orders <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+--------------+--------+</span>
<span class="token operator">|</span> Coyote Inc<span class="token punctuation">.</span>    <span class="token operator">|</span> Y Lee        <span class="token operator">|</span>      <span class="token number">2</span> <span class="token operator">|</span>
<span class="token operator">|</span> E Fudd         <span class="token operator">|</span> E Fudd       <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span> Mouse House    <span class="token operator">|</span> Jerry Mouse  <span class="token operator">|</span>      <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> Wascals        <span class="token operator">|</span> Jim Jones    <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span> Yosemite Place <span class="token operator">|</span> Y Sam        <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+--------------+--------+</span>
</code></pre></div><hr> <br> <h2 id="联结表"><a href="#联结表" class="header-anchor">#</a> 联结表</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 等值联结（equi join），它基于两个表之间的相等测试。这种联结也称为 内部联结。</span>
<span class="token keyword">SELECT</span> vend_name<span class="token punctuation">,</span> prod_name<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> vendors<span class="token punctuation">,</span> products <span class="token keyword">WHERE</span> vendors<span class="token punctuation">.</span>vend_id <span class="token operator">=</span> products<span class="token punctuation">.</span>vend_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> vend_name<span class="token punctuation">,</span> prod_name<span class="token punctuation">;</span>


<span class="token comment">### 内部联结的语法</span>
<span class="token keyword">SELECT</span> vend_name<span class="token punctuation">,</span> prod_name<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> vendors <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> products <span class="token keyword">ON</span> vendors<span class="token punctuation">.</span>vend_id <span class="token operator">=</span> products<span class="token punctuation">.</span>vend_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> vend_name<span class="token punctuation">,</span> prod_name<span class="token punctuation">;</span>


<span class="token comment">### 上面提到用子查询，返回订购产品 TNT 的客户列表，现在改成联结表的方式，可以跟子查询的方式对比一下。</span>
<span class="token keyword">SELECT</span> cust_name<span class="token punctuation">,</span> cust_contact <span class="token keyword">FROM</span> customers<span class="token punctuation">,</span> orders<span class="token punctuation">,</span> orderitems <span class="token keyword">WHERE</span> customers<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> orders<span class="token punctuation">.</span>cust_id <span class="token operator">AND</span> orders<span class="token punctuation">.</span>order_num <span class="token operator">=</span> orderitems<span class="token punctuation">.</span>order_num <span class="token operator">AND</span> prod_id <span class="token operator">=</span> <span class="token string">'TNT2'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="注意-7"><a href="#注意-7" class="header-anchor">#</a> 注意</h3> <ul><li>应该保证所有的联结都有 WHERE 子句，否则 MySQL 将返回比想要的数据多得多的数据。</li></ul> <hr> <br> <h2 id="创建高级联结"><a href="#创建高级联结" class="header-anchor">#</a> 创建高级联结</h2> <h3 id="表别名和自联结"><a href="#表别名和自联结" class="header-anchor">#</a> 表别名和自联结</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 使用表别名，返回订购产品 TNT 的客户列表</span>
<span class="token keyword">SELECT</span> cust_name<span class="token punctuation">,</span> cust_contact <span class="token keyword">FROM</span> customers <span class="token keyword">AS</span> c<span class="token punctuation">,</span> orders <span class="token keyword">AS</span> o<span class="token punctuation">,</span> orderitems <span class="token keyword">AS</span> oi <span class="token keyword">WHERE</span> c<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> o<span class="token punctuation">.</span>cust_id <span class="token operator">AND</span> o<span class="token punctuation">.</span>order_num <span class="token operator">=</span> oi<span class="token punctuation">.</span>order_num <span class="token operator">AND</span> prod_id <span class="token operator">=</span> <span class="token string">'TNT2'</span><span class="token punctuation">;</span>

<span class="token comment">### 使用自联结，查找商品 ID 为 DTNTR 的供应商供应的所有产品</span>
<span class="token keyword">SELECT</span> p1<span class="token punctuation">.</span>prod_id<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>prod_name <span class="token keyword">FROM</span> products <span class="token keyword">AS</span> p1<span class="token punctuation">,</span> products <span class="token keyword">AS</span> p2 <span class="token keyword">WHERE</span> p1<span class="token punctuation">.</span>vend_id <span class="token operator">=</span> p2<span class="token punctuation">.</span>vend_id <span class="token operator">AND</span> p2<span class="token punctuation">.</span>prod_id <span class="token operator">=</span> <span class="token string">'DTNTR'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="外部联结"><a href="#外部联结" class="header-anchor">#</a> 外部联结</h3> <p>外部联结包含了那些在相关表中没有关联行的行，外部联结的两种基本形式：左外部联结(LEFT OUTER JOIN 即 LEFT JOIN)和右外部联结。它们之间唯一差别是所关联的表的顺序不同。更具体可以看一下 <a href="https://segmentfault.com/a/1190000015572505" target="_blank" rel="noopener noreferrer">JOIN 详解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 列出每个客户下的订单，包括那些至今未下订单的客户</span>
<span class="token keyword">SELECT</span> customers<span class="token punctuation">.</span>cust_id<span class="token punctuation">,</span> orders<span class="token punctuation">.</span>order_num <span class="token keyword">FROM</span> customers <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> orders <span class="token keyword">ON</span> customers<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> orders<span class="token punctuation">.</span>cust_id<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+-----------+</span>
<span class="token operator">|</span> cust_id <span class="token operator">|</span> order_num <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------+</span>
<span class="token operator">|</span>   <span class="token number">10001</span> <span class="token operator">|</span>     <span class="token number">20005</span> <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">10001</span> <span class="token operator">|</span>     <span class="token number">20009</span> <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">10002</span> <span class="token operator">|</span>      <span class="token boolean">NULL</span> <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">10003</span> <span class="token operator">|</span>     <span class="token number">20006</span> <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">10004</span> <span class="token operator">|</span>     <span class="token number">20007</span> <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">10005</span> <span class="token operator">|</span>     <span class="token number">20008</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------+</span>

<span class="token comment">#### 对每个用户下的订单计数，包括那些至今没下订单的客户</span>
<span class="token keyword">SELECT</span> c<span class="token punctuation">.</span>cust_name<span class="token punctuation">,</span> c<span class="token punctuation">.</span>cust_id<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>order_num<span class="token punctuation">)</span> <span class="token keyword">AS</span> order_count <span class="token keyword">FROM</span> customers <span class="token keyword">AS</span> c <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> orders <span class="token keyword">AS</span> o <span class="token keyword">ON</span> c<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> o<span class="token punctuation">.</span>cust_id <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> c<span class="token punctuation">.</span>cust_id<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------+---------+-------------+</span>
<span class="token operator">|</span> cust_name      <span class="token operator">|</span> cust_id <span class="token operator">|</span> order_count <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+---------+-------------+</span>
<span class="token operator">|</span> Coyote Inc<span class="token punctuation">.</span>    <span class="token operator">|</span>   <span class="token number">10001</span> <span class="token operator">|</span>           <span class="token number">2</span> <span class="token operator">|</span>
<span class="token operator">|</span> Mouse House    <span class="token operator">|</span>   <span class="token number">10002</span> <span class="token operator">|</span>           <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> Wascals        <span class="token operator">|</span>   <span class="token number">10003</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span> Yosemite Place <span class="token operator">|</span>   <span class="token number">10004</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">|</span> E Fudd         <span class="token operator">|</span>   <span class="token number">10005</span> <span class="token operator">|</span>           <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+---------+-------------+</span>
</code></pre></div><hr> <br> <h3 id="组合查询"><a href="#组合查询" class="header-anchor">#</a> 组合查询</h3> <p>MySQL 允许执行多个查询（多条 SELECT 语句），并将结果作为单个查询结果集返回。这些组合查询称为并（union） 或 复合查询（compound query）。</p> <p>有两种基本情况，其中需要使用组合查询：</p> <ul><li>在单个查询中从不同的表返回类似结构的数据；</li> <li>对单个表执行多个查询，按单个查询返回数据。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 查询价格小于等于5的所有物品并且查出供应商 1001 和 1002 生产的所有物品（不考虑价格）</span>

<span class="token comment">### 先用 WHERE 多个子句来实现。</span>
<span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_price <span class="token operator">&lt;=</span> <span class="token number">5</span> <span class="token operator">OR</span> vend_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token number">1002</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">### 使用组合查询实现，会自动去除重复的行</span>
<span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_price <span class="token operator">&lt;=</span> <span class="token number">5</span> <span class="token keyword">UNION</span> <span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> vend_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span> <span class="token number">1002</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">### 使用组合查询查所有符合条件的列</span>
<span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_price <span class="token operator">&lt;=</span> <span class="token number">5</span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> <span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> vend_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span> <span class="token number">1002</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">### 组合查询排序</span>
<span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_price <span class="token operator">&lt;=</span> <span class="token number">5</span> <span class="token keyword">UNION</span> <span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> vend_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span> <span class="token number">1002</span><span class="token punctuation">)</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">;</span>
</code></pre></div><h3 id="注意-8"><a href="#注意-8" class="header-anchor">#</a> 注意</h3> <ul><li>UNION 必须由两条或两条以上的 SELECT 语句组成，语句之间用关键字 UNION 分隔。</li> <li>UNION 中的每个查询必须包含相同的列，表达式或聚集函数（不过各个列不需要以相同的次序列出）。</li> <li>对组合查询结果排序时，只能使用一条 ORDER BY 子句，它必须出现在最后一条 SELECT 语句之后。</li></ul> <hr> <br> <h2 id="数据库索引"><a href="#数据库索引" class="header-anchor">#</a> 数据库索引</h2> <h3 id="什么是数据库索引"><a href="#什么是数据库索引" class="header-anchor">#</a> <strong>什么是数据库索引？</strong></h3> <p>通俗地说，<strong>索引（Index）</strong> 就像一本书的目录。当我们想找到一本书中特定的内容时，可以直接根据目录定位到具体的页码，而不需要从第一页开始逐页翻找。同样，在数据库中，索引是一种加速查询的结构，可以快速找到某些特定数据，而不需要扫描整个表。</p> <h3 id="为什么需要索引"><a href="#为什么需要索引" class="header-anchor">#</a> <strong>为什么需要索引？</strong></h3> <p>假设有一个学生表（<code>students</code>），包含 10 万条学生信息。如果你想查找某个学生的名字，数据库默认会逐行扫描整个表（称为全表扫描，效率较低）。但如果你为 <code>name</code> 字段创建了索引，那么数据库可以直接通过索引快速找到对应的记录，而不需要遍历整个表。</p> <h3 id="索引的具体作用"><a href="#索引的具体作用" class="header-anchor">#</a> <strong>索引的具体作用</strong></h3> <ol><li><strong>加速查询</strong>：让查询速度更快。</li> <li><strong>加速排序</strong>：索引可以帮助数据库快速对数据进行排序。</li> <li><strong>提高多表查询效率</strong>：在关联查询时，索引可以显著提高连接性能。</li></ol> <p>虽然索引能提升查询效率，但它也有 <strong>缺点</strong>：</p> <ul><li>索引会占用额外的存储空间。</li> <li>索引会稍微降低数据的插入、删除和更新速度（因为需要维护索引结构）。</li></ul> <h3 id="索引的分类"><a href="#索引的分类" class="header-anchor">#</a> <strong>索引的分类</strong></h3> <p>以下是常见的几种索引类型，通俗解释和使用示例：</p> <h4 id="_1-普通索引-basic-index"><a href="#_1-普通索引-basic-index" class="header-anchor">#</a> <strong>1. 普通索引（Basic Index）</strong></h4> <ul><li><strong>通俗解释</strong>：这是最常见的索引类型，用于加速查询操作。</li> <li><strong>示例</strong>：假设有一张学生表 <code>students</code>，我们经常根据 <code>name</code> 查询学生信息。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 创建普通索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_name <span class="token keyword">ON</span> students<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 查询某个学生的信息</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> students <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">'Alice'</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>查询过程：</strong></p> <ul><li>如果没有索引，数据库会扫描整个表来查找 <code>name = 'Alice'</code> 的记录。</li> <li>如果有索引，数据库会直接通过索引找到对应的记录。</li></ul> <h4 id="_2-唯一索引-unique-index"><a href="#_2-唯一索引-unique-index" class="header-anchor">#</a> <strong>2. 唯一索引（Unique Index）</strong></h4> <ul><li><strong>通俗解释</strong>：唯一索引除了加速查询，还能保证某个字段的值不能重复。</li> <li><strong>示例</strong>：学生的学号（<code>student_id</code>）是唯一的，我们可以为它创建唯一索引。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 创建唯一索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> idx_student_id <span class="token keyword">ON</span> students<span class="token punctuation">(</span>student_id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 查询某个学号的学生信息</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> students <span class="token keyword">WHERE</span> student_id <span class="token operator">=</span> <span class="token string">'2023001'</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>特点：</strong></p> <ul><li>如果你尝试插入重复的 <code>student_id</code>，数据库会报错，提示违反唯一约束。</li></ul> <h4 id="_3-主键索引-primary-key-index"><a href="#_3-主键索引-primary-key-index" class="header-anchor">#</a> <strong>3. 主键索引（Primary Key Index）</strong></h4> <ul><li><strong>通俗解释</strong>：主键是一种特殊的唯一索引，它不仅唯一，还不能为 <code>NULL</code>。</li> <li><strong>示例</strong>：
在设计学生表时，我们通常会将 <code>student_id</code> 设置为主键，确保每个学生都有唯一的学号。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 创建表时定义主键索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> students <span class="token punctuation">(</span>
  student_id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span> <span class="token comment">-- 主键会自动创建索引</span>
  name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  age <span class="token keyword">INT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 查询某个学号的学生信息</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> students <span class="token keyword">WHERE</span> student_id <span class="token operator">=</span> <span class="token number">12345</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>特点：</strong></p> <ul><li>主键自动创建索引。</li> <li>每个表只能有一个主键。</li></ul> <h4 id="_4-复合索引-composite-index"><a href="#_4-复合索引-composite-index" class="header-anchor">#</a> <strong>4. 复合索引（Composite Index）</strong></h4> <ul><li><strong>通俗解释</strong>：复合索引是针对多个字段一起创建的索引，用于加速多条件查询。</li> <li><strong>示例</strong>：假设我们经常根据学生的 <code>name</code> 和 <code>age</code> 两个条件查询信息。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 创建复合索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_name_age <span class="token keyword">ON</span> students<span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 查询某个名字和年龄的学生信息</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> students <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">'Alice'</span> <span class="token operator">AND</span> age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>注意：</strong></p> <ul><li>复合索引的字段顺序很重要，比如 <code>name</code> 在前，<code>age</code> 在后。</li> <li>索引可以加速以下查询：<div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> students <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">'Alice'</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> students <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">'Alice'</span> <span class="token operator">AND</span> age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
</code></pre></div>但对于只查询 <code>age</code> 的条件，如 <code>WHERE age = 20</code>，复合索引不起作用。</li></ul> <h4 id="_5-全文索引-full-text-index"><a href="#_5-全文索引-full-text-index" class="header-anchor">#</a> <strong>5. 全文索引（Full-Text Index）</strong></h4> <ul><li><strong>通俗解释</strong>：用于加速文本字段的模糊查询，比如搜索文章内容中的某个关键词。</li> <li><strong>示例</strong>：假设我们有一张文章表 <code>articles</code>，需要根据内容中的关键词查找文章。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 创建全文索引</span>
<span class="token keyword">CREATE</span> FULLTEXT <span class="token keyword">INDEX</span> idx_content <span class="token keyword">ON</span> articles<span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 搜索包含 &quot;database&quot; 的文章</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> articles <span class="token keyword">WHERE</span> <span class="token keyword">MATCH</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> AGAINST<span class="token punctuation">(</span><span class="token string">'database'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>特点：</strong></p> <ul><li>全文索引适用于大量文本数据的搜索。</li> <li>比普通的 <code>LIKE '%keyword%'</code> 查询更高效。</li></ul> <h4 id="_6-聚集索引-clustered-index"><a href="#_6-聚集索引-clustered-index" class="header-anchor">#</a> <strong>6. 聚集索引（Clustered Index）</strong></h4> <ul><li><strong>通俗解释</strong>：聚集索引将数据的物理存储顺序与索引顺序保持一致。大多数数据库（如 MySQL 的 InnoDB 引擎）默认使用主键作为聚集索引。</li> <li><strong>特点</strong>：
<ul><li>一个表只能有一个聚集索引。</li> <li>查询主键或范围数据时性能非常高。</li></ul></li></ul> <h3 id="索引的使用示例"><a href="#索引的使用示例" class="header-anchor">#</a> <strong>索引的使用示例</strong></h3> <p>假设有一个学生表 <code>students</code>，表结构如下：</p> <table><thead><tr><th>student_id</th> <th>name</th> <th>age</th> <th>grade</th></tr></thead> <tbody><tr><td>1</td> <td>Alice</td> <td>20</td> <td>A</td></tr> <tr><td>2</td> <td>Bob</td> <td>22</td> <td>B</td></tr> <tr><td>3</td> <td>Charlie</td> <td>21</td> <td>A</td></tr></tbody></table> <h4 id="查询示例"><a href="#查询示例" class="header-anchor">#</a> 查询示例</h4> <ol><li><p><strong>没有索引的查询：</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> students <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">'Alice'</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>数据库会扫描整个表（全表扫描），逐行比较 <code>name</code> 是否等于 <code>'Alice'</code>。</li> <li>如果表有 10 万行，查询会很慢。</li></ul></li> <li><p><strong>有索引的查询：</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_name <span class="token keyword">ON</span> students<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> students <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">'Alice'</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>数据库会通过索引直接定位到 <code>name = 'Alice'</code> 的记录，显著提升查询速度。</li></ul></li></ol> <h3 id="索引可能带来的问题"><a href="#索引可能带来的问题" class="header-anchor">#</a> <strong>索引可能带来的问题</strong></h3> <ol><li><strong>插入/更新性能下降</strong>：
<ul><li>每次插入、更新或删除数据时，索引也需要同步更新，可能会导致性能下降。</li></ul></li> <li><strong>占用存储空间</strong>：
<ul><li>索引需要额外的磁盘空间，尤其是创建了多个索引时，存储开销会增加。</li></ul></li> <li><strong>错误使用复合索引</strong>：
<ul><li>如果复合索引的字段顺序不符合查询条件顺序，索引可能不起作用。</li></ul></li></ol> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> <strong>总结</strong></h3> <ol><li><strong>索引是数据库优化的利器</strong>，可以显著提升查询性能。</li> <li><strong>常见类型</strong>：
<ul><li>普通索引：加速查询。</li> <li>唯一索引：加速查询并保证唯一性。</li> <li>复合索引：适合多条件查询。</li> <li>全文索引：适合文本搜索。</li></ul></li> <li><strong>使用注意事项</strong>：
<ul><li>不要对每个字段都创建索引，应该根据实际查询场景添加。</li> <li>索引会影响写入性能，所以需要平衡增删改与查询的性能需求。</li></ul></li></ol> <hr> <br> <h2 id="全文本搜索"><a href="#全文本搜索" class="header-anchor">#</a> 全文本搜索</h2> <p>并非所有引擎都支持全文本搜索，例如 MyISAM 支持全文本搜索，InnoDB 不支持。</p> <p>在创建表时启用全文本搜索， CREATE TABLE 语句接受 FULLTEXT 子句，它可以对后面的一个或多个表建立索引，MySQL 自动维护该索引，在增加、更新或删除行时，索引随之自动更新。FULLTEXT 也可以在表创建之后再指定。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 看一下 productnotes 表的创建描述</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>productnotes<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>note_id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>prod_id<span class="token punctuation">`</span></span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>note_date<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>note_text<span class="token punctuation">`</span></span> <span class="token keyword">text</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>note_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  FULLTEXT <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>note_text<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>note_text<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span>MyISAM <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">115</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_0900_ai_ci

</code></pre></div><p>创建索引后就可以用 Match() 和 Against() 执行全文本搜索，其中 Match() 指定被搜索的列， Against() 指定要使用的搜索表达式。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 搜索出 node_text 中包含 rabbit 的。</span>

<span class="token comment">### 先用 LIKE 实现</span>
<span class="token keyword">SELECT</span> note_text <span class="token keyword">FROM</span> productnotes <span class="token keyword">WHERE</span> note_text <span class="token operator">LIKE</span> <span class="token string">'%rabbit%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------------------------------------+</span>
<span class="token operator">|</span> Quantity varies<span class="token punctuation">,</span> …… <span class="token keyword">for</span> <span class="token keyword">use</span> <span class="token keyword">as</span> rabbit bait<span class="token punctuation">.</span> <span class="token operator">|</span>
<span class="token operator">|</span> Customer complaint: rabbit has …… <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------------------------------+</span>

<span class="token comment">### 使用文本搜索实现，可以看到 rabbit 排在第三个词的文本比排在第20个词的文本排序高。</span>
<span class="token keyword">SELECT</span> note_text <span class="token keyword">FROM</span> productnotes <span class="token keyword">WHERE</span> <span class="token keyword">Match</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> Against<span class="token punctuation">(</span><span class="token string">'rabbit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------------------------------------+</span>
<span class="token operator">|</span> Customer complaint: rabbit has …… <span class="token operator">|</span>
<span class="token operator">|</span> Quantity varies<span class="token punctuation">,</span> …… <span class="token keyword">for</span> <span class="token keyword">use</span> <span class="token keyword">as</span> rabbit bait<span class="token punctuation">.</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------------------------------+</span>

<span class="token comment">### 可以使用下面的语句查看排序的等级</span>
<span class="token keyword">SELECT</span> note_text<span class="token punctuation">,</span> <span class="token keyword">Match</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> Against<span class="token punctuation">(</span><span class="token string">'rabbit'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> rank1 <span class="token keyword">FROM</span> productnotes<span class="token punctuation">;</span>
<span class="token comment">### 除了查出来的两个有数据，其他的等级都是0</span>
<span class="token operator">|</span> Customer complaint: rabbit has …… <span class="token operator">|</span> 的等级是 <span class="token number">1.6408053636550903</span>
<span class="token operator">|</span> Quantity varies<span class="token punctuation">,</span> …… <span class="token keyword">for</span> <span class="token keyword">use</span> <span class="token keyword">as</span> rabbit bait<span class="token punctuation">.</span> <span class="token operator">|</span> 的等级是 <span class="token number">1.5905543565750122</span>


<span class="token comment">### 使用查询扩展 WITH QUERY EXPANSION ，找出所有提到 anvils 的注释，还要找出与当前搜索有关的所有其他行，即使它们不包含 anvils</span>
<span class="token keyword">SELECT</span> note_text <span class="token keyword">FROM</span> productnotes <span class="token keyword">WHERE</span> <span class="token keyword">Match</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> Against<span class="token punctuation">(</span><span class="token string">'anvils'</span> <span class="token keyword">WITH</span> QUERY EXPANSION<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">### 会返回7行，但是只有第一行有 anvils ,第二行虽然与 anvils 无关，但因为它包含了第一行的两个词，所以也被检索出来。</span>

</code></pre></div><h3 id="注意-9"><a href="#注意-9" class="header-anchor">#</a> 注意</h3> <ul><li>传递给 Match() 的值必须与 FULLTEXT() 定义中的相同。如果指定多个列，必须列出他们，而且次序正确。</li> <li>经过比较可以发现，文本搜索是默认带有排序的，LIKE 搜索出来的结果是随意的，按照查询的先后输出。</li> <li>文本搜索的等级根据行中词的数目，唯一词的数目，整个索引中词的总数，以及包含该词的行的书目计算出来。</li> <li>在索引全文本数据时，短词被忽略且从索引中排除。短词的定义时那些具有 3 个或 3 个一下字符的词（如果需要，这个数目可以改）</li> <li>许多词出现的频率很高，搜索他们没用，MySQL 规定了一条 50% 规则，如果一个词出现 50%以上的行中，则将它作为一个非用词忽略。50%规则不用于 IN BOOLEAN MODE。</li> <li>如果表中的行数少于 3 行，则全文本搜索不返回结果</li> <li>忽略词中的单引号。例如，don't 索引为 dont</li> <li>不具有词分隔符（包括日语和汉语）的语言不能恰当地返回全文本搜索结果</li></ul> <h3 id="布尔文本查询"><a href="#布尔文本查询" class="header-anchor">#</a> 布尔文本查询</h3> <p>IN BOOLEAN MODE，即使没有 FULLTEXT 索引，也可以使用</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 匹配包含 heavy 但不包含任意以 rope 开始的词的行</span>
<span class="token keyword">SELECT</span> note_text <span class="token keyword">FROM</span> productnotes <span class="token keyword">WHERE</span> <span class="token keyword">Match</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> Against<span class="token punctuation">(</span><span class="token string">'heavy -rope*'</span> <span class="token operator">IN</span> <span class="token keyword">BOOLEAN</span> <span class="token keyword">MODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">### 匹配词 safe 和 combination, 降低后者的等级。</span>
<span class="token keyword">SELECT</span> note_text <span class="token keyword">FROM</span> productnotes <span class="token keyword">WHERE</span> <span class="token keyword">Match</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> Against<span class="token punctuation">(</span><span class="token string">'+safe +(&lt;combination)'</span> <span class="token operator">IN</span> <span class="token keyword">BOOLEAN</span> <span class="token keyword">MODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>全文本布尔操作符</p> <table><thead><tr><th>布尔操作符</th> <th>说 明</th></tr></thead> <tbody><tr><td>+</td> <td>包含，词必须存在</td></tr> <tr><td>-</td> <td>排除，词必须不出现</td></tr> <tr><td>&gt;</td> <td>包含，而且增加等级值</td></tr> <tr><td>&lt;</td> <td>包含，且减少等级值</td></tr> <tr><td>()</td> <td>把词组成子表达式（允许这些子表达式作为一个组被包含、排除、 排列等）</td></tr> <tr><td>~</td> <td>取消一个词的排序值</td></tr> <tr><td>*</td> <td>词尾的通配符</td></tr> <tr><td>&quot;&quot;</td> <td>定义一个短语（与单个词的列表不一样，它匹配整个短语以便包含或排除这个短语）</td></tr></tbody></table> <hr> <br> <h2 id="插入数据"><a href="#插入数据" class="header-anchor">#</a> 插入数据</h2> <h3 id="插入完整的行"><a href="#插入完整的行" class="header-anchor">#</a> 插入完整的行</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 如下的语句中，对每个列必须提供一个值，如果某个列没有值，应该使用 NULL 值（假设表允许对该列指定空值）。每个列必须按照顺序给出，自动增量的值也不能忽略，而且如果不想赋值，就需要指定为 NULL 。</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customers <span class="token keyword">VALUES</span><span class="token punctuation">(</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">'Pep E. LaPew'</span><span class="token punctuation">,</span> <span class="token string">'100 Main Street'</span><span class="token punctuation">,</span> <span class="token string">'Los Angeles'</span><span class="token punctuation">,</span> <span class="token string">'CA'</span><span class="token punctuation">,</span> <span class="token string">'90046'</span><span class="token punctuation">,</span> <span class="token string">'USA'</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面的语法应该避免使用，因为不安全，建议用下面的语句,可以不按照次序填充，只要保证 VALUES 中的次序跟前面给出的列名次序一致就行。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customers<span class="token punctuation">(</span>cust_name<span class="token punctuation">,</span> cust_contact<span class="token punctuation">,</span> cust_email<span class="token punctuation">,</span> cust_address<span class="token punctuation">,</span> cust_city<span class="token punctuation">,</span> cust_state<span class="token punctuation">,</span> cust_zip<span class="token punctuation">,</span> cust_country<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'Pep E. LaPew'</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">'100 Main Street'</span><span class="token punctuation">,</span> <span class="token string">'Los ANGELES'</span><span class="token punctuation">,</span> <span class="token string">'CA'</span><span class="token punctuation">,</span> <span class="token string">'90046'</span><span class="token punctuation">,</span> <span class="token string">'USA'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="插入多个行"><a href="#插入多个行" class="header-anchor">#</a> 插入多个行</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 可以使用多条 INSERT 语句，甚至一次提交它们，每条语句用一个分号结束。</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customers<span class="token punctuation">(</span>cust_name<span class="token punctuation">,</span>cust_address<span class="token punctuation">,</span>cust_city<span class="token punctuation">,</span>cust_state<span class="token punctuation">,</span>cust_zip<span class="token punctuation">,</span>cust_country<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'Pep E. LaPew'</span><span class="token punctuation">,</span><span class="token string">'100 Main Street'</span><span class="token punctuation">,</span><span class="token string">'Los Angeles'</span><span class="token punctuation">,</span><span class="token string">'CA'</span><span class="token punctuation">,</span><span class="token string">'90046'</span><span class="token punctuation">,</span><span class="token string">'USA'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customers<span class="token punctuation">(</span>cust_name<span class="token punctuation">,</span>cust_address<span class="token punctuation">,</span>cust_city<span class="token punctuation">,</span>cust_state<span class="token punctuation">,</span>cust_zip<span class="token punctuation">,</span>cust_country<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'M. Martian'</span><span class="token punctuation">,</span><span class="token string">'42 Galaxy Way'</span><span class="token punctuation">,</span><span class="token string">'New York'</span><span class="token punctuation">,</span><span class="token string">'NY'</span><span class="token punctuation">,</span><span class="token string">'11213'</span><span class="token punctuation">,</span><span class="token string">'USA'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">### 或者每条 INSERT 语句中的列名（和次序）相同，可以如下组合语句</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customers<span class="token punctuation">(</span>cust_name<span class="token punctuation">,</span>cust_address<span class="token punctuation">,</span>cust_city<span class="token punctuation">,</span>cust_state<span class="token punctuation">,</span>cust_zip<span class="token punctuation">,</span>cust_country<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'Pep E. LaPew'</span><span class="token punctuation">,</span><span class="token string">'100 Main Street'</span><span class="token punctuation">,</span><span class="token string">'Los Angeles'</span><span class="token punctuation">,</span><span class="token string">'CA'</span><span class="token punctuation">,</span><span class="token string">'90046'</span><span class="token punctuation">,</span><span class="token string">'USA'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'M. Martian'</span><span class="token punctuation">,</span><span class="token string">'42 Galaxy Way'</span><span class="token punctuation">,</span><span class="token string">'New York'</span><span class="token punctuation">,</span><span class="token string">'NY'</span><span class="token punctuation">,</span><span class="token string">'11213'</span><span class="token punctuation">,</span><span class="token string">'USA'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="注意-10"><a href="#注意-10" class="header-anchor">#</a> 注意</h3> <ul><li>在 INSERT 操作中可以省略某些列，省略的列必须满足：该列定义为允许 NULL 值（无值或者空值），或在表定义中给出默认值，这表示如果不给出值，将使用默认值，否则插入时省略会报错。</li> <li>可以使用 INSERT LOW PRIORITY INTO 来降低插入语句的优先级。</li></ul> <hr> <br> <h2 id="更新数据"><a href="#更新数据" class="header-anchor">#</a> 更新数据</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 更新id是10009客户名字的邮箱。</span>
<span class="token keyword">UPDATE</span> customers <span class="token keyword">SET</span> cust_name <span class="token operator">=</span> <span class="token string">'The Fudds'</span><span class="token punctuation">,</span> cust_email <span class="token operator">=</span> <span class="token string">'elmer@fudd.com'</span> <span class="token keyword">WHERE</span> cust_id <span class="token operator">=</span> <span class="token number">10009</span><span class="token punctuation">;</span>

<span class="token comment">### 为了删除某个列的值，可设置它为 NULL（假定表定义为允许 NULL 值）</span>
<span class="token keyword">UPDATE</span> customers <span class="token keyword">SET</span> cust_email <span class="token operator">=</span> <span class="token boolean">NULL</span> <span class="token keyword">WHERE</span> cust_id <span class="token operator">=</span> <span class="token number">10009</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="注意-11"><a href="#注意-11" class="header-anchor">#</a> 注意</h3> <ul><li>使用 UPDATE 时，一定不能省略 WHERE 子句，否则就会更新表中的所有行。</li> <li>UPDATE 操作如果报错，则整个 UPDATE 操作被取消，错误发生前更新的所有行被恢复到它们原来的值，如果想发生错误的时候也继续进行更新，可以使用 IGNORE 关键字 <code>UPDATE IGNORE customers</code></li></ul> <hr> <br> <h2 id="删除数据"><a href="#删除数据" class="header-anchor">#</a> 删除数据</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 删除10011这一行</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> customers <span class="token keyword">WHERE</span> cust_id <span class="token operator">=</span> <span class="token number">10011</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="注意-12"><a href="#注意-12" class="header-anchor">#</a> 注意</h3> <ul><li>使用 DELETE 时，一定不能省略 WHERE 子句，否则就会删除表中的所有行。即使删除所有行， DELETE 也不会删除表本身。</li> <li>如果想从表中删除所有行，不要使用 DELETE。可以使用 TRUNCATE TABLE 语句，速度更快（TRUNCATE 实际是删除原来的表并重新创建一个表，而不是逐行删除表中的数据）。</li></ul> <hr> <br> <h2 id="创建和操作表"><a href="#创建和操作表" class="header-anchor">#</a> 创建和操作表</h2> <h3 id="创建表"><a href="#创建表" class="header-anchor">#</a> 创建表</h3> <p>利用 CREATE TABLE 创建表，必须紧跟着给出新表的名字，然后是表列的名字和定义，用逗号分隔。</p> <h4 id="null-值"><a href="#null-值" class="header-anchor">#</a> NULL 值</h4> <p>NULL 值就是没有值或缺值。允许 NULL 值的列也允许在插入行时不给出该列的值。 NOT NULL 即不允许 NULL 值的列不接受该列没有值的行，在插入或更新行时，该列必须有值。NULL 是默认设置，如果不指定 NOT NULL，则认为指定的是 NULL。</p> <h4 id="主键"><a href="#主键" class="header-anchor">#</a> 主键</h4> <p>主键必须是唯一的，即表中的每个行必须具有唯一的主键值，如果主键使用单个列，则它的值必须唯一。如果使用多个列，则这些列的组合值必须唯一。</p> <p>使用类似 PRIMARY KEY (id) 的语句来定义。为创建由多个列组成的主键，应该以逗号分隔的列表给出各列名，例如 orderitems 表的创建用到的 PRIMARY KEY (order_num, order_item)</p> <p>主键可以在创建表时定义，或者在创建表之后定义。</p> <p>主键为唯一标识表中每个行的列，主键中只能使用不允许 NULL 值的列。</p> <h4 id="auto-increment"><a href="#auto-increment" class="header-anchor">#</a> AUTO_INCREMENT</h4> <p>每次执行一个 INSERT 操作时， MySQL 自动对该列增量。</p> <p>每个表只能允许一个 AUTO_INCREMENT 列，而且它必须被索引（比如通过使用它成为主键）</p> <p>在执行 INSERT 时可以给 AUTO_INCREMENT 指定一个值，只要它是至今为止唯一的就行，该值将被用来替代自动生成的值。后续的增量将开始使用该手工插入的值。</p> <p>last_insert_id() 这个函数能返回最后一个 AUTO_INCREMENT 值</p> <h4 id="指定默认值"><a href="#指定默认值" class="header-anchor">#</a> 指定默认值</h4> <p>列定义中的 DEFAULT 关键字指定。 MySQL 跟大多数 DBMS 一样， 不允许使用函数作为默认值，它只支持常量。</p> <h4 id="引擎类型"><a href="#引擎类型" class="header-anchor">#</a> 引擎类型</h4> <p>大多数时候， CREATE TABLE 语句全都以 ENGINE=InnoDB 语句结束。MySQL 具有多种引擎，这些打包的多个引擎都隐藏在 MySQL 的服务器内，全都能执行 CREATE TABLE 和 SELECT 等命令。这些引擎具有各自不同的功能和特性，为不同的任务选择正确的引擎能获得良好的功能和灵活性。</p> <p><strong>InnoDB</strong> 是一个可靠的事务处理引擎，它不支持全文本搜索。</p> <p><strong>MyISAM</strong> 是一个性能极高的引擎，它支持全文本搜索，但不支持事务处理</p> <p><strong>MEMORY</strong> 在功能等同于 MyISAM，但由于数据存储在内存（不是磁盘）中，速度很快（特别适合用于临时表）</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">########################</span>
<span class="token comment"># 看一下 customers 表的创建</span>
<span class="token comment">########################</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> customers
<span class="token punctuation">(</span>
  cust_id      <span class="token keyword">int</span>       <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  cust_name    <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  cust_address <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>  <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  cust_city    <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>  <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  cust_state   <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>   <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  cust_zip     <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  cust_country <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>  <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  cust_contact <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>  <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  cust_email   <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>cust_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="更新表"><a href="#更新表" class="header-anchor">#</a> 更新表</h3> <p>为了更新表定义，可使用 ALTER TABLE 语句。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### vendors 表中增加 vend_phone 列</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> vendors <span class="token keyword">ADD</span> vend_phone <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">### 删除刚刚增加的 vend_phone 列</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> vendors <span class="token keyword">DROP</span> <span class="token keyword">COLUMN</span> vend_phone<span class="token punctuation">;</span>

<span class="token comment">### ALTER TABLE 常见的用途就是定义外键</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> products <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> fk_products_vendors <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>vend_id<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> vendors <span class="token punctuation">(</span>vend_id<span class="token punctuation">)</span>
</code></pre></div><h3 id="删除表"><a href="#删除表" class="header-anchor">#</a> 删除表</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> customers2<span class="token punctuation">;</span>
</code></pre></div><h3 id="重命名表"><a href="#重命名表" class="header-anchor">#</a> 重命名表</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 重命名一个表</span>
<span class="token keyword">RENAME</span> <span class="token keyword">TABLE</span> customers2 <span class="token keyword">TO</span> customers<span class="token punctuation">;</span>

<span class="token comment">### 重命名多个表</span>
<span class="token keyword">RENAME</span> <span class="token keyword">TABLE</span> backup_customers <span class="token keyword">TO</span> customers<span class="token punctuation">,</span>backup_vendors <span class="token keyword">TO</span> vendors<span class="token punctuation">;</span>
</code></pre></div><h3 id="注意-13"><a href="#注意-13" class="header-anchor">#</a> 注意</h3> <ul><li>创建新表时，指定的表名必须不存在，否则将出错。如果仅想在一个表不存在时创建它，应该在表名后面给出 IF NOT EXISTS。</li> <li>使用 ALTER TABLE 要极为小心，应该在进行改动之前做一个完整的备份（模式和数据的备份）</li></ul> <hr> <br> <h2 id="使用视图"><a href="#使用视图" class="header-anchor">#</a> 使用视图</h2> <p>视图仅仅是用来查看存储在别处的数据的一种设施，本身不包含数据，返回的数据都是从其他表中检索出来的，视图能更改数据格式和表示，最常见的应用就是重用 SQL 语句，简化复杂的 SQL 操作。</p> <h3 id="操作视图"><a href="#操作视图" class="header-anchor">#</a> 操作视图</h3> <p>CREATE VIEW 创建视图</p> <p>SHOW CREATE VIEW viewname 查看创建视图的语句</p> <p>DROP VIEW viewname 删除视图</p> <p>更新视图时，可以先 DROP 然后再 CREATE 或者使用 CREATE OR REPLACE VIEW</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 之前有用联表查询 prod_id 是 TNT2的购买用户信息，但是如果还想看 prod_id 是其他值的时，还得重新查一遍，这样的场景就能用到视图了。</span>

<span class="token comment">### 创建一个包含 cust_name, cust_contact, prod_id 的视图</span>
<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> productcustomers <span class="token keyword">AS</span> <span class="token keyword">SELECT</span> cust_name<span class="token punctuation">,</span> cust_contact<span class="token punctuation">,</span> prod_id <span class="token keyword">FROM</span> customers<span class="token punctuation">,</span> orders<span class="token punctuation">,</span> orderitems <span class="token keyword">WHERE</span> customers<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> orders<span class="token punctuation">.</span>cust_id <span class="token operator">AND</span> orderitems<span class="token punctuation">.</span>order_num <span class="token operator">=</span> orders<span class="token punctuation">.</span>order_num<span class="token punctuation">;</span>

<span class="token comment">### 现在就能看到 productcustomers 视图能查询的信息了</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> productcustomers<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------+--------------+---------+</span>
<span class="token operator">|</span> cust_name      <span class="token operator">|</span> cust_contact <span class="token operator">|</span> prod_id <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+--------------+---------+</span>
<span class="token operator">|</span> Coyote Inc<span class="token punctuation">.</span>    <span class="token operator">|</span> Y Lee        <span class="token operator">|</span> ANV01   <span class="token operator">|</span>
<span class="token operator">|</span> Coyote Inc<span class="token punctuation">.</span>    <span class="token operator">|</span> Y Lee        <span class="token operator">|</span> ANV02   <span class="token operator">|</span>
<span class="token operator">|</span> Coyote Inc<span class="token punctuation">.</span>    <span class="token operator">|</span> Y Lee        <span class="token operator">|</span> TNT2    <span class="token operator">|</span>
<span class="token operator">|</span> Coyote Inc<span class="token punctuation">.</span>    <span class="token operator">|</span> Y Lee        <span class="token operator">|</span> FB      <span class="token operator">|</span>
<span class="token operator">|</span> Coyote Inc<span class="token punctuation">.</span>    <span class="token operator">|</span> Y Lee        <span class="token operator">|</span> FB      <span class="token operator">|</span>
<span class="token operator">|</span> Coyote Inc<span class="token punctuation">.</span>    <span class="token operator">|</span> Y Lee        <span class="token operator">|</span> OL1     <span class="token operator">|</span>
<span class="token operator">|</span> Coyote Inc<span class="token punctuation">.</span>    <span class="token operator">|</span> Y Lee        <span class="token operator">|</span> SLING   <span class="token operator">|</span>
<span class="token operator">|</span> Coyote Inc<span class="token punctuation">.</span>    <span class="token operator">|</span> Y Lee        <span class="token operator">|</span> ANV03   <span class="token operator">|</span>
<span class="token operator">|</span> Wascals        <span class="token operator">|</span> Jim Jones    <span class="token operator">|</span> JP2000  <span class="token operator">|</span>
<span class="token operator">|</span> Yosemite Place <span class="token operator">|</span> Y Sam        <span class="token operator">|</span> TNT2    <span class="token operator">|</span>
<span class="token operator">|</span> E Fudd         <span class="token operator">|</span> E Fudd       <span class="token operator">|</span> FC      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+--------------+---------+</span>

<span class="token comment">### 如果想再查询出 prod_id 为 TNT2 的客户信息就很简单了</span>
<span class="token keyword">SELECT</span> cust_name<span class="token punctuation">,</span> cust_contact <span class="token keyword">FROM</span> productcustomers <span class="token keyword">WHERE</span> prod_id <span class="token operator">=</span> <span class="token string">'TNT2'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------+--------------+</span>
<span class="token operator">|</span> cust_name      <span class="token operator">|</span> cust_contact <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+--------------+</span>
<span class="token operator">|</span> Coyote Inc<span class="token punctuation">.</span>    <span class="token operator">|</span> Y Lee        <span class="token operator">|</span>
<span class="token operator">|</span> Yosemite Place <span class="token operator">|</span> Y Sam        <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+--------------+</span>
</code></pre></div><h3 id="注意-14"><a href="#注意-14" class="header-anchor">#</a> 注意</h3> <ul><li>视图必须唯一命名（不能跟别的视图和表重名）</li> <li>对于可以创建的视图数量没有限制。</li> <li>视图可以嵌套，即可以利用从其他视图中检索数据的查询来构造一个新的视图。</li> <li>ORDER BY 可以用在视图中，但如果从该视图检索数据的 SELECT 中也含有 ORDER BY ，那么视图中的 ORDER BY 会被覆盖。</li> <li>视图不能索引，也不能有关联的触发器或默认值。</li> <li>视图可以和表一起使用。</li> <li>视图一般用于检索（SELECT）而不用于更新（INSERT, UPDATE, DELETE），因为更新一个视图相当于更新其基表，如果不能正确地确定被更新的基数据，则不允许更新。</li></ul> <hr> <br> <h2 id="使用存储过程"><a href="#使用存储过程" class="header-anchor">#</a> 使用存储过程</h2> <p>使用存储过程主要有三个好处，简单，安全，高性能。</p> <p>MySQL 称存储过程的执行为调用，因此 MySQL 执行存储过程的语句为 CALL。CALL 接受存储过程的名字以及需要传递给它的任意参数。</p> <h3 id="简单例子"><a href="#简单例子" class="header-anchor">#</a> 简单例子</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 创建名为 productpricing 的存储过程 如果存储过程接受参数，它们将在 productpricing () 这个括号中列举出来。</span>
<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> productpricing<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
<span class="token keyword">SELECT</span> <span class="token function">Avg</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> priceaverage <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token comment">//</span>


<span class="token comment">### 调用存储过程，仿佛在调用函数</span>
<span class="token keyword">CALL</span> productpricing<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
<span class="token operator">|</span> priceaverage <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>
<span class="token operator">|</span>    <span class="token number">16.133571</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+</span>


<span class="token comment">### 删除存储过程</span>
<span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> productpricing<span class="token punctuation">;</span>

<span class="token comment">### 检查存储过程</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> productpricing<span class="token punctuation">;</span>
</code></pre></div><h3 id="有参数的例子"><a href="#有参数的例子" class="header-anchor">#</a> 有参数的例子</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 创建存储过程</span>
<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> productpricing <span class="token punctuation">(</span>
  <span class="token keyword">OUT</span> pl <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">OUT</span> ph <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">OUT</span> pa <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
  <span class="token keyword">SELECT</span> <span class="token function">Min</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">INTO</span> pl <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
  <span class="token keyword">SELECT</span> <span class="token function">Max</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">INTO</span> ph <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
  <span class="token keyword">SELECT</span> <span class="token function">Avg</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">INTO</span> pa <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>


<span class="token comment">### 调用存储过程</span>
<span class="token keyword">CALL</span> productpricing<span class="token punctuation">(</span><span class="token variable">@pricelow</span><span class="token punctuation">,</span><span class="token variable">@pricehigh</span><span class="token punctuation">,</span><span class="token variable">@priceaverage</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">### 查看3个变量</span>
<span class="token keyword">SELECT</span> <span class="token variable">@pricelow</span><span class="token punctuation">,</span><span class="token variable">@pricehigh</span><span class="token punctuation">,</span><span class="token variable">@priceaverage</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------+------------+---------------+</span>
<span class="token operator">|</span> <span class="token variable">@pricelow</span> <span class="token operator">|</span> <span class="token variable">@pricehigh</span> <span class="token operator">|</span> <span class="token variable">@priceaverage</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+------------+---------------+</span>
<span class="token operator">|</span>      <span class="token number">2.50</span> <span class="token operator">|</span>      <span class="token number">55.00</span> <span class="token operator">|</span>         <span class="token number">16.13</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+------------+---------------+</span>
</code></pre></div><h3 id="建立智能存储过程"><a href="#建立智能存储过程" class="header-anchor">#</a> 建立智能存储过程</h3> <p>需要获取订单合计，并且对某些顾客的合计增加营业税。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 存储过程全过程</span>
<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token comment">-- Name: ordertotal</span>
<span class="token comment">-- Parameters: onumber = order number</span>
<span class="token comment">--             taxable = 0 if not taxable, 1 if taxable</span>
<span class="token comment">--             ototal = order total variable</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> ordertotal <span class="token punctuation">(</span>
  <span class="token operator">IN</span> onumber <span class="token keyword">INT</span><span class="token punctuation">,</span>
  <span class="token operator">IN</span> taxable <span class="token keyword">BOOLEAN</span><span class="token punctuation">,</span>
  <span class="token keyword">OUT</span> ototal <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
 <span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'Obtain order total, optionally adding tax'</span>
 <span class="token keyword">BEGIN</span>

  <span class="token comment">-- Declare variable for total</span>
  <span class="token keyword">DECLARE</span> total <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">-- Declare tax percentage</span>
  <span class="token keyword">DECLARE</span> taxrate <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">6</span><span class="token punctuation">;</span>

  <span class="token comment">-- Get the order total</span>
  <span class="token keyword">SELECT</span> <span class="token function">Sum</span><span class="token punctuation">(</span>item_price<span class="token operator">*</span>quantity<span class="token punctuation">)</span> <span class="token keyword">FROM</span> orderitems <span class="token keyword">WHERE</span> order_num <span class="token operator">=</span> onumber <span class="token keyword">INTO</span> total<span class="token punctuation">;</span>

  <span class="token comment">-- Is this taxable</span>
  <span class="token keyword">IF</span> taxable <span class="token keyword">THEN</span>
  <span class="token comment">-- Yes, so add taxrate to the total</span>
    <span class="token keyword">SELECT</span> total<span class="token operator">+</span><span class="token punctuation">(</span>total<span class="token operator">/</span><span class="token number">100</span><span class="token operator">*</span>taxrate<span class="token punctuation">)</span> <span class="token keyword">INTO</span> total<span class="token punctuation">;</span>
  <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>

  <span class="token comment">-- And finally, save to out variable</span>
  <span class="token keyword">SELECT</span> total <span class="token keyword">INTO</span> ototal<span class="token punctuation">;</span>

 <span class="token keyword">END</span> <span class="token comment">//</span>


 <span class="token comment">### 调用，看一下 order number 是 20005 订单关于加不加营业税的区别</span>
 <span class="token comment">### 不加营业税</span>
 <span class="token keyword">CALL</span> ordertotal<span class="token punctuation">(</span><span class="token number">20005</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">@total</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">SELECT</span> <span class="token variable">@total</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------+</span>
<span class="token operator">|</span> <span class="token variable">@total</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+</span>
<span class="token operator">|</span> <span class="token number">149.87</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+</span>

<span class="token comment">### 加营业税</span>
<span class="token keyword">CALL</span> ordertotal<span class="token punctuation">(</span><span class="token number">20005</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">@total</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@total</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------+</span>
<span class="token operator">|</span> <span class="token variable">@total</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+</span>
<span class="token operator">|</span> <span class="token number">158.86</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------+</span>
</code></pre></div><p>上面代码中做些必要的解释</p> <ul><li>添加了两个 IN 类型参数，其中 taxable 为布尔值。</li> <li><code>--</code> 添加注释，在存储过程复杂是，注释很有必要。</li> <li><code>DECLARE</code> 定义局部变量，需要指定变量名和数据类型，支持可选的默认值</li> <li><code>COMMENT</code> 关键字，不是必需的，如果添加了，在 SHOW PROCEDURE STATUS 的结果中显示。</li></ul> <h3 id="注意-15"><a href="#注意-15" class="header-anchor">#</a> 注意</h3> <ul><li>如果在 mysql 命令行中创建存储过程的话，需要临时更改命令行实用程序的语句分隔符，因为创建存储过程会使用 ; 作为语句分隔符，这会导致语法报错。除了 \ 符号外，任何字符都可以用作语句分隔符。 可以使用 DELIMITER // 作为新的语句结束分隔符，但是创建完存储过程后，要记得用 DELIMITER ; 恢复为原来的语句分隔符。</li> <li>存储过程在创建之后，被保存在服务器上以供使用，直至被删除。</li> <li>如果删除不存在的存储过程时，会报错，可以使用 DROP PROCEDURE IF EXISTS ,只有当过程存在时才删除。</li> <li>MySQL 支持 IN（传递给存储过程）、OUT（从存储过程传出）、INOUT（对存储过程传入和传出）三种类型的参数。SELECT 检索出来的值通过 INTO 保存到相应的变量。特别注意，参数的数据类型不能是一个集合，所以例子中才用了三个参数输出 3 个数。</li> <li>如果存储过程要求 3 个参数，就必须正好传递 3 个参数。</li> <li><code>SHOW PROCEDURE STATUS</code> 可以列出所有存储过程，也可以使用 LIKE 指定一个过滤模式： <code>SHOW PROCEDURE STATUS LIKE 'ordertotal';</code></li></ul> <hr> <br> <h2 id="使用游标"><a href="#使用游标" class="header-anchor">#</a> 使用游标</h2> <p>游标（cursor）是一个存储在 MySQL 服务器上的数据库查询，它不是一条 SELECT 语句，而是被该语句检索出来的结果集。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>
<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> processorders<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">BEGIN</span>
    <span class="token keyword">DECLARE</span> done <span class="token keyword">BOOLEAN</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">DECLARE</span> o <span class="token keyword">INT</span><span class="token punctuation">;</span>
    <span class="token keyword">DECLARE</span> t <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">DECLARE</span> ordernumbers <span class="token keyword">CURSOR</span>
    <span class="token keyword">FOR</span>
    <span class="token keyword">SELECT</span> order_num <span class="token keyword">FROM</span> orders<span class="token punctuation">;</span>
    <span class="token keyword">DECLARE</span> <span class="token keyword">CONTINUE</span> <span class="token keyword">HANDLER</span> <span class="token keyword">FOR</span> SQLSTATE <span class="token string">'02000'</span> <span class="token keyword">SET</span> done <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> ordertotals<span class="token punctuation">(</span>order_num <span class="token keyword">INT</span><span class="token punctuation">,</span> total <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">OPEN</span> ordernumbers<span class="token punctuation">;</span>
    <span class="token keyword">REPEAT</span>
    <span class="token keyword">FETCH</span> ordernumbers <span class="token keyword">INTO</span> o<span class="token punctuation">;</span>
    <span class="token keyword">CALL</span> ordertotal<span class="token punctuation">(</span>o<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> ordertotals<span class="token punctuation">(</span>order_num<span class="token punctuation">,</span>total<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    UNTIL done <span class="token keyword">END</span> <span class="token keyword">REPEAT</span><span class="token punctuation">;</span>
    <span class="token keyword">CLOSE</span> ordernumbers<span class="token punctuation">;</span>
  <span class="token keyword">END</span><span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> ordertotals<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------+---------+</span>
<span class="token operator">|</span> order_num <span class="token operator">|</span> total   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+---------+</span>
<span class="token operator">|</span>     <span class="token number">20005</span> <span class="token operator">|</span>  <span class="token number">158.86</span> <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token number">20009</span> <span class="token operator">|</span>   <span class="token number">40.78</span> <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token number">20006</span> <span class="token operator">|</span>   <span class="token number">58.30</span> <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token number">20007</span> <span class="token operator">|</span> <span class="token number">1060.00</span> <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token number">20008</span> <span class="token operator">|</span>  <span class="token number">132.50</span> <span class="token operator">|</span>
<span class="token operator">|</span>     <span class="token number">20008</span> <span class="token operator">|</span>  <span class="token number">132.50</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+---------+</span>
</code></pre></div><p><code>DECLARE</code> 命名游标，并定义相应的 SELECT 语句，根据需要带 WHERE 和其他子句。</p> <p><code>OPEN ordernumbers;</code> 打开 ordernumbers 游标，在处理 OPEN 语句时执行查询，存储检索出的数据以供浏览和滚动。</p> <p><code>CLOSE ordernumbers;</code> 关闭 ordernumbers 游标，CLOSE 释放游标使用的所有内部内存和资源，因此在每个游标不再需要时都应该关闭，如果没有明确关闭游标，MySQL 将会在到达 END 语句时自动关闭它。在一个游标关闭后，如果没有重新打开，就不能使用它。但是，使用声明过的游标不需要再次声明，用 OPEN 语句打开就行。</p> <p><code>FETCH</code> 指定检索什么数据，检索出来的数据存储在什么地方。它还向前移动游标中的内部行指针，使下一条 FETCH 语句检索下一行。</p> <p><code>CONTINUE HANDLER</code> 是在条件出现时被执行的代码。上面 <code>SQLSTATE '02000'</code> 出现时 <code>SET done = 1</code>。<code>SQLSTATE '02000'</code>是一个未找到条件，上面指的是 REPEAT 由于没有更多的行供循环而不能继续时，出现这个条件。</p> <h3 id="注意-16"><a href="#注意-16" class="header-anchor">#</a> 注意：</h3> <ul><li>跟其他的 DBMS 不同的是，MySQL 游标只能用于存储过程（和函数）</li> <li>在使用游标前，必须声明（定义）游标。声明的过程实际上没有检索数据，它只是定义要使用的 SELECT 语句。</li> <li>声明之后，如果要使用游标，必须打开游标。这个过程是用前面定义的 SELECT 语句把数据实际检索出来。</li> <li>在结束游标使用时，必须关闭游标。</li></ul> <hr> <br> <h2 id="使用触发器"><a href="#使用触发器" class="header-anchor">#</a> 使用触发器</h2> <p>触发器是 MySQL 响应以下任意语句而自动执行的一条 MySQL 语句，（或位于 BEGIN 和 END 语句之间的一组语句）:</p> <ul><li>DELETE;</li> <li>INSERT;</li> <li>UPDATE;</li></ul> <h3 id="创建触发器遵循以下几点"><a href="#创建触发器遵循以下几点" class="header-anchor">#</a> 创建触发器遵循以下几点</h3> <ul><li>唯一的触发器名；</li> <li>触发器关联的表；</li> <li>触发器应该响应的活动（DELETE、INSERT 和 UPDATE）；</li> <li>触发器何时执行（处理之前或之后）</li></ul> <p><code>CREATE TRIGGER</code> 新建触发器</p> <p><code>DROP TRIGGER</code> 删除触发器</p> <h3 id="insert-触发器"><a href="#insert-触发器" class="header-anchor">#</a> INSERT 触发器</h3> <ul><li>在 INSERT 触发器代码内，可以引用一个名为 NEW 的虚拟表，访问被插入的行；</li> <li>在 BEFORE INSERT 触发器中，NEW 中的值可以被更新（允许更改被插入的值）</li> <li>对于 AUTO_INCREMENT 列， NEW 在 INSERT 执行之前包含 0，在 INSERT 执行之后包含新的自动生成值。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 创建一个名为 neworder 的触发器，在插入一个新订单到 orders 表时，返回新的订单号放到变量@number中。</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> neworder <span class="token keyword">AFTER</span> <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> orders <span class="token keyword">FOR EACH ROW</span> <span class="token keyword">SELECT</span> NEW<span class="token punctuation">.</span>order_num<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> orders<span class="token punctuation">(</span>order_date<span class="token punctuation">,</span> cust_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@number</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+</span>
<span class="token operator">|</span> <span class="token variable">@number</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+</span>
<span class="token operator">|</span>   <span class="token number">20010</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+</span>

</code></pre></div><h3 id="delete-触发器"><a href="#delete-触发器" class="header-anchor">#</a> DELETE 触发器</h3> <ul><li>在 DELETE 触发器代码内，可以引用一个名为 OLD 的虚拟表，访问被删除的行；</li> <li>OLD 中的值是只读的，不能更新。</li></ul> <h3 id="update-触发器"><a href="#update-触发器" class="header-anchor">#</a> UPDATE 触发器</h3> <ul><li>在 UPDATE 触发器代码内，可以引用一个名为 OLD 的虚拟表，访问以前（UPDATE 语句前）的值，引用一个名为 NEW 的虚拟表访问新更新的值；</li> <li>在 BEFORE UPDATE 触发器中，NEW 中的值可以被更新（允许更改将要用于 UPDATE 语句中的值）</li> <li>OLD 中的值是只读的，不能更新。</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">### 创建一个名为 neworder 的触发器，在插入一个新订单到 orders 表时，返回新的订单号放到变量@number中。</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> neworder <span class="token keyword">AFTER</span> <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> orders <span class="token keyword">FOR EACH ROW</span> <span class="token keyword">SELECT</span> NEW<span class="token punctuation">.</span>order_num<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> orders<span class="token punctuation">(</span>order_date<span class="token punctuation">,</span> cust_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@number</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+</span>
<span class="token operator">|</span> <span class="token variable">@number</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+</span>
<span class="token operator">|</span>   <span class="token number">20010</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+</span>

</code></pre></div><h3 id="注意-17"><a href="#注意-17" class="header-anchor">#</a> 注意</h3> <ul><li>只有表才支持触发器，视图不支持（临时表也不支持）。</li> <li>触发器按每个表每个事件每次地定义，每个表每个事件每次只允许一个触发器。因此，每个表最多支持 6 个触发器（每条 INSERT、UPDATE 和 DELETE 的之前和之后）</li> <li>单一触发器不能与多个事件或多个表关联，所以，如果需要一个对 INSERT 和 UPDATE 操作执行的触发器，就应该定义两个触发器。</li> <li>如果 BEFORE 触发器失败，MySQL 将不执行请求的操作。如果 BEFORE 触发器或语句本身失败， MySQL 将不执行 AFTER 触发器（如果有的话）。</li> <li>MySQL 的 TRIGGER 和 FUNCTION 中不能出现 SELECT * FROM table 形式的查询，因为其会返回一个结果集，而这在 MySQL 的 TRIGGER 和 FUNCTION 中是不可接受的，但是在存储过程中可以。在 TRIGGER 和 FUNCTION 中可以使用 SELECT ... INTO ... 形式的查询。</li> <li>使用 TRIGGER 的时候没有 INTO 的时候会报这样一种错误 <code>not allowed to return a result set from a trigger</code></li> <li>MySQL 触发器中不支持 CALL 语句，这表示不能从触发器内调用存储过程。所需的存储过程代码需要复制到触发器内。</li></ul> <hr> <br> <h2 id="管理事务处理"><a href="#管理事务处理" class="header-anchor">#</a> 管理事务处理</h2> <p>事务处理（transaction processing）可以用来维护数据库的完整性，它保证成批的 MySQL 操作要么完全执行，要么完全不执行。</p> <p>事务处理是一种机制，用来管理必须成批执行的 MySQL 操作，以保证数据库不包含不完整的操作结果。使用事务处理，可以保证一组操作不会中途停止，它们要么整体执行，要么完全不执行（除非明确指示）如果没有错误发生，整租语句提交给（写到）数据库表。如果发生错误，则进行回退（撤销）以恢复数据库到某个已知且安全的状态。</p> <ul><li>事务（transaction）指一组 SQL 语句，语句 <code>START TRANSACTION</code></li> <li>回退（rollback） 指撤销指定的 SQL 语句的过程，语句 <code>ROLLBACK TO onename</code></li> <li>提交（commit） 指将未存储的 SQL 语句结果写入数据库表，语句 <code>COMMIT</code> <ul><li>一般的 MySQL 语句都是直接针对数据库表执行和编写的，提交（写或保存）操作是自动进行的，这就是所谓的隐含提交（implicit commit）</li> <li>在事务处理中，提交不会隐含地进行，为了进行明确的提交，使用 COMMIT 语句</li></ul></li> <li>保留点（savepoint） 指事务处理中设置的临时占位符（place-holder）,你可以对它发布回退（与回退整个事务处理不同）。为了支持回退部分事务处理，必须能在事务处理块中合适的位置放置保留点，这样，如果需要回退，可以回退到某个占位符，即某个保留点。语句： <code>SAVEPOINT onename</code></li></ul> <p>假设一个场景：系统添加订单的过程</p> <ol><li>检查数据库中是否存在相应的客户（从 customers 表查询），如果不存在，添加 TA。</li> <li>检索客户的 ID</li> <li>添加一行到 orders 表，把它与客户 ID 关联</li> <li>检索 orders 表中赋予的新订单的 ID</li> <li>对于订购的每个物品在 orderitems 表中添加一行，通过检索出来的 ID 把它与 orders 表关联（以及通过产品 ID 与 products 表关联）</li></ol> <p>现在假如由于某种数据库故障（如超出磁盘空间、安全限制、表锁等）阻止了这个过程的完成，如果发生在添加客户之后，orders 表添加之前还好，但是如果故障发生在 orders 行添加之后，orderitems 行添加之前，那么数据库中就会有一个空订单，如果发生在添加 orderitems 行中出现的故障，那数据库就可能有不完整的订单，而且这个不完整的订单还不会被发现。</p> <p>所以我们要把过程改一下：</p> <ol><li>检查数据库中是否存在相应的客户（从 customers 表查询），如果不存在，添加 TA。</li> <li><strong>提交</strong>客户信息</li> <li>检索客户的 ID</li> <li>添加一行到 orders 表</li> <li>如果在添加行到 orders 表时出现故障，<strong>回退</strong></li> <li>检索 orders 表中赋予的新订单 ID</li> <li>对于订购的每项商品，添加新行到 orderitems 表</li> <li>如果在添加新行到 orderitems 表时出现故障，<strong>回退</strong>所有添加的 orderitems 行和 orders 行</li> <li>提交订单信息</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code>
</code></pre></div><h3 id="注意-18"><a href="#注意-18" class="header-anchor">#</a> 注意</h3> <ul><li>当 COMMIT 和 ROLLBACK 语句执行后，事务会自动关闭（将来的更改会隐含提交）</li> <li>每个保留点都要取一个唯一的名字，以便回退时，MySQL 知道要回退到何处。保留点尽量越多越好，这样就可以更灵活的回退。保留点在事务处理完成（执行一条 ROLLBACK 或 COMMIT）后自动释放。也可以使用 RELEASE SAVEPOINT 明确地释放保留点。</li></ul> <hr> <br> <h2 id="数据库维护"><a href="#数据库维护" class="header-anchor">#</a> 数据库维护</h2> <h3 id="备份数据"><a href="#备份数据" class="header-anchor">#</a> 备份数据</h3> <h4 id="mysqldump"><a href="#mysqldump" class="header-anchor">#</a> mysqldump</h4> <p>mysqldump 是一个逻辑备份工具，复制原始的数据库对象定义和表数据产生一组可执行的 SQL 语句。在日常工作中，我们会使用 mysqldump 命令创建 SQL 格式的转存储文件来备份数据库，或者把数据导出后做数据迁移，主备搭建等操作。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># --user、-u 指定连接的用户名，--password、-p 连接数据库密码，--port、-P 连接数据库端口号</span>


<span class="token comment"># --all-databases 会导出包括系统数据库在内的所有数据库</span>
mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>proot <span class="token comment">--all-databases &gt; /tmp/all.sql</span>
mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>p <span class="token comment">--all-databases &gt; /tmp/all.sql # 需要回车后输入密码</span>

<span class="token comment"># --add-drop-database 在导出的备份文件中，在 CREATE DATABASE 语句前加上 DROP DATABASE 语句</span>

<span class="token comment"># --add-drop-table 在导出的备份文件中，在 CREATE TABLE 语句前加上 DROP TABLE 语句</span>

<span class="token comment"># --databases 导出database1、database2两个数据库的所有数据</span>
mysqldump <span class="token comment">--user root --password=root --databases database1 database2 &gt; /tmp/user.sql</span>

<span class="token comment"># --tables 导出database1中的table1、table2表</span>
mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>proot <span class="token comment">--databases database1 --tables table1 table2  &gt; /tmp/database1.sql</span>

<span class="token comment"># --routines、-R 导出目标数据库里的触发器和函数</span>
mysqldump  <span class="token operator">-</span>uroot <span class="token operator">-</span>proot <span class="token comment">--host=localhost --all-databases --routines</span>

<span class="token comment"># --where、-w 只导出符合WHERE条件的记录。如果条件包含命令解释符专用空格或字符，一定要将条件引用起来，单引号和双引号都可以</span>
mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>proot <span class="token comment">--databases database1 --tables table1 --where='id=1'  &gt; /tmp/table1.sql</span>

<span class="token comment"># --no-data、-d 不导出任何数据，只导出数据库表结构</span>
mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>proot <span class="token comment">--no-data --databases database1 &gt;/tmp/database1.sql</span>

<span class="token comment"># --no-create-info、-t 只导出数据，导出的sql中不包含drop table,create table</span>
mysqldump <span class="token operator">-</span>uroot <span class="token operator">-</span>proot <span class="token comment">--no-create-info --databases database1 --tables table1 --where=&quot;id='a'&quot;  &gt;/tmp/table1.sql</span>

<span class="token comment"># --host、-h 需要导出的主机信息，跨服务器导出导入数据</span>
mysqldump <span class="token comment">--host=h1 -uroot -proot --databases database1 |mysql --host=h2 -uroot -proot database2</span>

</code></pre></div><h4 id="注意-19"><a href="#注意-19" class="header-anchor">#</a> 注意</h4> <ul><li>导出指定表只能针对一个数据库进行导出，且导出的内容中和导出数据库也不一样，导出指定表的导出文本中没有创建数据库的判断语句，只有删除表-创建表-导入数据</li></ul> <hr> <br> <h2 id="补充"><a href="#补充" class="header-anchor">#</a> 补充</h2> <h3 id="一些注意点"><a href="#一些注意点" class="header-anchor">#</a> 一些注意点</h3> <h4 id="_1、多条-sql-语句必须以分号-分隔。"><a href="#_1、多条-sql-语句必须以分号-分隔。" class="header-anchor">#</a> 1、多条 SQL 语句必须以分号（;）分隔。</h4> <h4 id="_2、sql-语句不区分大小写-因此-例如-select-和-select-是相同的-即使写成-select-都是没有问题的。大家约定俗成的把-sql-关键词大写-其他的列和表名用小写-这样做使代码更易于阅读和调试。"><a href="#_2、sql-语句不区分大小写-因此-例如-select-和-select-是相同的-即使写成-select-都是没有问题的。大家约定俗成的把-sql-关键词大写-其他的列和表名用小写-这样做使代码更易于阅读和调试。" class="header-anchor">#</a> 2、SQL 语句不区分大小写，因此，例如 SELECT 和 select 是相同的，即使写成 SelEct 都是没有问题的。大家约定俗成的把 SQL 关键词大写，其他的列和表名用小写，这样做使代码更易于阅读和调试。</h4> <h4 id="_3、在处理-sql-语句时-其中所有空格都会被忽略。"><a href="#_3、在处理-sql-语句时-其中所有空格都会被忽略。" class="header-anchor">#</a> 3、在处理 SQL 语句时，其中所有空格都会被忽略。</h4> <h3 id="其他指令"><a href="#其他指令" class="header-anchor">#</a> 其他指令</h3> <h3 id="查看当前-mysql-版本或者当前在哪个数据库中。"><a href="#查看当前-mysql-版本或者当前在哪个数据库中。" class="header-anchor">#</a> 查看当前 MySQL 版本或者当前在哪个数据库中。</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 登录之前，查看版本</span>
mysql <span class="token operator">-</span>V

<span class="token comment"># 登录之后使用MySQL的函数（大小写均可）查看版本</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> VERSION<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 登录之后，使用 status 或者 \s 查看版本和当前使用的数据库</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">status</span>
mysql<span class="token operator">&gt;</span> \s
</code></pre></div><h3 id="查看当前-mysql-的密码策略"><a href="#查看当前-mysql-的密码策略" class="header-anchor">#</a> 查看当前 MySQL 的密码策略</h3> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'validate_password%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+--------+</span>
<span class="token operator">|</span> Variable_name                        <span class="token operator">|</span> <span class="token keyword">Value</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+--------+</span>
<span class="token operator">|</span> validate_password<span class="token punctuation">.</span>check_user_name    <span class="token operator">|</span> <span class="token keyword">ON</span>     <span class="token operator">|</span>
<span class="token operator">|</span> validate_password<span class="token punctuation">.</span>dictionary_file    <span class="token operator">|</span>        <span class="token operator">|</span>
<span class="token operator">|</span> validate_password<span class="token punctuation">.</span>length             <span class="token operator">|</span> <span class="token number">8</span>      <span class="token operator">|</span>
<span class="token operator">|</span> validate_password<span class="token punctuation">.</span>mixed_case_count   <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span>
<span class="token operator">|</span> validate_password<span class="token punctuation">.</span>number_count       <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span>
<span class="token operator">|</span> validate_password<span class="token punctuation">.</span>policy             <span class="token operator">|</span> MEDIUM <span class="token operator">|</span>
<span class="token operator">|</span> validate_password<span class="token punctuation">.</span>special_char_count <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+--------+</span>
</code></pre></div><p>要注意 <code>validate_password_policy：密码强度检查等级</code></p> <table><thead><tr><th>级别</th> <th>描述</th></tr></thead> <tbody><tr><td>0/LOW</td> <td>只检查长度。</td></tr> <tr><td>1/MEDIUM</td> <td>检查长度、数字、大小写、特殊字符。</td></tr> <tr><td>2/STRONG</td> <td>检查长度、数字、大小写、特殊字符字典文件</td></tr></tbody></table> <ul><li><p><a href="https://raydoom.github.io/work/mysql/2018/09/13/mysql-validate-password/" target="_blank" rel="noopener noreferrer">详见 mysql 密码策略设置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="http://blog.itpub.net/20893244/viewspace-2565368/" target="_blank" rel="noopener noreferrer">MySQL8.0 SHOW VARIABLES 为 empty set 可看此文<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h3 id="其他的-show-命令列表"><a href="#其他的-show-命令列表" class="header-anchor">#</a> 其他的 SHOW 命令列表</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 用于显示广泛的服务器状态信息</span>
<span class="token keyword">SHOW</span> <span class="token keyword">STATUS</span><span class="token punctuation">;</span>

<span class="token comment"># 显示创建特定数据库的MySQL语句，例如展示 learnsql 数据库的创建语句</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> learnsql<span class="token punctuation">;</span>

<span class="token comment"># 显示创建特定表的MySQL语句，例如展示 customers 表的创建语句</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> customers<span class="token punctuation">;</span>

<span class="token comment"># 显示服务器的错误信息</span>
<span class="token keyword">SHOW</span> <span class="token keyword">ERRORS</span><span class="token punctuation">;</span>

<span class="token comment"># 显示服务器的警告信息</span>
<span class="token keyword">SHOW</span> <span class="token keyword">WARNINGS</span><span class="token punctuation">;</span>

<span class="token comment"># 显示所有允许的 SHOW 语句</span>
HELP <span class="token keyword">SHOW</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/qiqihaobenben/Front-End-Basics/edit/master/docs/database/mysql/mysql.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/26/2024, 8:50:43 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f0c3bf6e.js" defer></script><script src="/assets/js/2.267df354.js" defer></script><script src="/assets/js/1.66cc43cf.js" defer></script><script src="/assets/js/133.cc4ee14d.js" defer></script>
  </body>
</html>
